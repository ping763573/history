<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>龍騰四海：大明王朝</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* --- 字體導入 --- */
      @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+TC:wght@400;700;900&family=ZCOOL+XiaoWei&family=Zhi+Mang+Xing&display=swap');
      
      /* --- 變數定義 (明代風格) --- */
      :root {
        --bg-color: #FDFBF5; /* 泛黃宣紙 */
        --primary-color: #8C1B17; /* 主色 - 帝王紅 */
        --accent-color: #C5A56A;  /* 強調色 - 鎏金 */
        --accent-light: #EAE0C8;  /* 強調淺色 - 淡金 */
        --text-color: #3D3D3D;    /* 內文顏色 - 深灰黑 */
        --title-font: 'Ma Shan Zheng', 'Noto Serif TC', serif;
        --body-font: 'Noto Serif TC', serif;
        --cursive-font: 'Zhi Mang Xing', cursive;
        --elegant-font: 'ZCOOL+XiaoWei', serif;
      }

      html { scroll-behavior: smooth; }
      body {
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: var(--body-font);
        font-size: 18px;
        background-image: url('https://www.transparenttextures.com/patterns/paper.png'); /* 書卷紋理 */
        overflow-x: hidden;
      }
      
      /* --- 水墨卷轴效果 --- */
      .silk-scroll-effect {
        position: relative;
      }
      .silk-scroll-effect::before,
      .silk-scroll-effect::after {
        content: '';
        position: absolute;
        width: 60px;
        height: 100%;
        top: 0;
        z-index: 5;
        background: linear-gradient(90deg, rgba(253, 251, 245, 0.8), transparent);
        pointer-events: none;
      }
      .silk-scroll-effect::before { left: 0; }
      .silk-scroll-effect::after { right: 0; transform: rotate(180deg); }
      
      /* --- 通用區塊設定 --- */
      .slide-section {
        width: 100%;
        min-height: 100vh;
        padding: 180px 40px 80px; 
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        max-width: 1600px;
        margin: 0 auto;
        border-bottom: 1px solid rgba(140, 27, 23, 0.1);
        overflow: hidden; /* 新增，確保子元素不會溢出 */
      }
      
      /* --- 内容承载层 --- */
      .content-container {
        background: rgba(253, 251, 245, 0.92);
        border-radius: 12px;
        padding: 40px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(197, 165, 106, 0.3);
        position: relative;
        z-index: 10;
        width: 90%;
        max-width: 1400px;
        margin: 0 auto;
      }
      .content-container::before {
        content: '';
        position: absolute;
        top: 10px;
        left: 10px;
        right: 10px;
        bottom: 10px;
        border: 2px solid rgba(197, 165, 106, 0.15);
        border-radius: 8px;
        pointer-events: none;
        z-index: -1;
      }

      /* --- 標題美化 --- */
      .section-title {
        font-family: var(--title-font);
        font-size: 4.5rem;
        color: var(--primary-color);
        margin-bottom: 50px;
        text-align: center;
        line-height: 1.2;
        position: relative;
        padding-bottom: 30px;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.1);
        letter-spacing: 2px;
      }
      /* 标题装饰线 (龍紋筆觸) */
      .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 10px;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="10" viewBox="0 0 200 10"><path d="M0,5 C40,2 80,8 120,5 S160,2 200,6" fill="none" stroke="%23C5A56A" stroke-width="3" stroke-linecap="round"/></svg>');
        background-repeat: no-repeat;
        background-position: center;
      }

      /* --- 導覽列 --- */
      .navbar {
        position: fixed; top: 0; left: 0; width: 100%;
        background-color: rgba(140, 27, 23, 0.95); /* 帝王紅 */
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        z-index: 1000; padding: 15px 20px;
        transition: all 0.4s ease;
      }
      .navbar.scrolled { padding: 10px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
      .nav-links { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px 25px; }
      .nav-links a {
        color: var(--bg-color); 
        font-family: var(--elegant-font);
        font-size: 18px; 
        padding: 10px 20px; 
        border-radius: 30px;
        transition: all 0.4s ease;
        position: relative;
        letter-spacing: 1px;
      }
      .nav-links a:hover, .nav-links a.active { 
        background: linear-gradient(135deg, var(--accent-color), #b49156);
        color: var(--primary-color);
        transform: translateY(-4px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      }
      .nav-links a::before {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        border-radius: 30px; background: linear-gradient(135deg, transparent, rgba(197, 165, 106, 0.3));
        opacity: 0; transition: opacity 0.3s ease;
      }
      .nav-links a:hover::before { opacity: 1; }

      /* --- 控制面板 --- */
      .control-panel { position: fixed; top: 120px; right: 30px; display: flex; flex-direction: column; gap: 15px; z-index: 999; }
      .control-btn {
        width: 55px; height: 55px;
        background: linear-gradient(135deg, var(--primary-color), #6e1512);
        color: var(--accent-color);
        border: 2px solid var(--accent-color);
        border-radius: 50%; display: flex; justify-content: center; align-items: center;
        cursor: pointer; font-size: 22px; transition: all 0.4s ease;
        box-shadow: 0 5px 15px rgba(0,0,0,0.25);
      }
      .control-btn:hover {
        background: linear-gradient(135deg, var(--accent-color), #b49156);
        color: var(--primary-color);
        transform: scale(1.15) rotate(12deg);
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      }
      #to-top-btn { display: none; }
      
      /* --- 語音導讀按鈕 Playing 狀態 --- */
      .tts-btn.is-playing { background-color: var(--accent-color); color: var(--primary-color); }
      .tts-btn.is-playing:hover { background-color: #b49156; }
      .autoplay-active .tts-btn { display: none; }
      
      /* --- 語音播放時鎖定畫面樣式 --- */
      body.tts-active .nav-links a, body.tts-active #to-top-btn {
          pointer-events: none; opacity: 0.5; cursor: not-allowed; transition: opacity 0.3s ease;
      }

      /* --- 捲動動畫 --- */
      .scroll-reveal { opacity: 0; transform: translateY(50px); transition: opacity 1s ease-out, transform 1s ease-out; }
      .scroll-reveal.visible { opacity: 1; transform: translateY(0); }
      
      /* --- 時間軸視覺強化 --- */
      .visual-timeline { position: relative; width: 100%; max-width: 900px; margin: 50px auto; padding: 20px 0; }
      .visual-timeline::after {
        content: ''; position: absolute; width: 8px; 
        background: linear-gradient(to bottom, transparent, var(--accent-color), transparent);
        top: 0; bottom: 0; left: 50%; margin-left: -4px; z-index: 1;
        border-radius: 10px; box-shadow: 0 0 15px rgba(197, 165, 106, 0.5);
      }
      .timeline-container { padding: 10px 40px; position: relative; background-color: inherit; width: 50%; }
      .timeline-container.left { left: 0; }
      .timeline-container.right { left: 50%; }
      .timeline-container::after {
        content: ''; position: absolute; width: 35px; height: 35px; right: -17px;
        background-color: var(--bg-color); border: 4px solid var(--primary-color);
        top: 25px; border-radius: 50%; z-index: 2; transition: all 0.4s ease;
        box-shadow: 0 0 0 6px rgba(197, 165, 106, 0.4);
      }
      .timeline-container:hover::after { transform: scale(1.4); background-color: var(--accent-color); box-shadow: 0 0 0 8px rgba(197, 165, 106, 0.6); }
      .timeline-container.right::after { left: -17px; }
      .timeline-content {
        padding: 30px 40px; 
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(234, 224, 200, 0.4)); 
        position: relative; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        border: 1px solid rgba(140, 27, 23, 0.2);
        border-left: 10px solid var(--primary-color);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        backdrop-filter: blur(4px);
      }
      .timeline-content:hover { transform: translateY(-15px) rotate(1deg); box-shadow: 0 15px 35px rgba(0,0,0,0.3); }
      .timeline-content h3 { font-size: 26px; color: var(--primary-color); font-family: var(--title-font); margin-bottom: 15px; border-bottom: 2px solid var(--accent-light); padding-bottom: 10px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
      .timeline-content p { font-size: 18px; line-height: 1.8; font-family: var(--elegant-font); }

      /* --- 互動地圖 --- */
      .map-container-interactive { 
        position: relative; width: 100%; max-width: 800px; border-radius: 15px;
        overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        border: 3px solid var(--accent-light);
        transform: perspective(1000px) rotateX(5deg) rotateY(0deg); transition: transform 0.5s ease;
      }
      .map-container-interactive:hover { transform: perspective(1000px) rotateX(2deg) rotateY(2deg); }
      .hotspot {
        position: absolute; width: 40px; height: 40px;
        background: radial-gradient(circle, rgba(197, 165, 106, 0.9), rgba(180, 145, 86, 0.9)); 
        border: 3px solid white; border-radius: 50%; cursor: pointer;
        transition: all 0.4s ease; display: flex; justify-content: center; align-items: center;
        box-shadow: 0 0 20px rgba(197, 165, 106, 0.8);
        animation: pulse 2s infinite; z-index: 10;
      }
      @keyframes pulse { 
        0% { transform: scale(1); box-shadow: 0 0 10px rgba(197, 165, 106, 0.5); } 
        50% { transform: scale(1.2); box-shadow: 0 0 30px rgba(197, 165, 106, 1); } 
        100% { transform: scale(1); box-shadow: 0 0 10px rgba(197, 165, 106, 0.5); } 
      }
      .hotspot:hover { transform: scale(1.6); background: radial-gradient(circle, var(--primary-color), #6e1512); animation-play-state: paused; z-index: 20; }
      .hotspot .fa-star { color: white; font-size: 18px; transition: transform 0.3s ease; }
      .hotspot:hover .fa-star { transform: rotate(360deg); }
      .info-box {
        display: none; position: absolute; 
        background: linear-gradient(135deg, rgba(40, 10, 8, 0.95), rgba(60, 15, 12, 0.95));
        color: var(--accent-light); padding: 25px; border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.6); z-index: 20;
        width: 300px; border-left: 5px solid var(--accent-color);
        font-family: var(--elegant-font); backdrop-filter: blur(8px); animation: fadeIn 0.4s ease;
      }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
      .info-box h3 { font-family: var(--title-font); font-size: 24px; color: var(--accent-color); margin-bottom: 15px; border-bottom: 1px solid rgba(197, 165, 106, 0.4); padding-bottom: 10px; }
      .info-box p { font-size: 17px; line-height: 1.7; }

      /* --- 卡片通用樣式 --- */
      .styled-card {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(234, 224, 200, 0.3));
        border: 1px solid rgba(197, 165, 106, 0.3);
        border-radius: 18px; padding: 30px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        height: 100%; display: flex; flex-direction: column;
        overflow: hidden; position: relative; backdrop-filter: blur(4px);
      }
      .styled-card::before {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px;
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      }
      .styled-card:hover { transform: translateY(-20px) rotate(2deg); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
      
      /* --- 圖片容器 --- */
      .image-container-styled {
        border-radius: 15px; overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        border: 6px solid var(--accent-color);
        display: flex; justify-content: center; align-items: center;
        width: 100%; transition: all 0.5s ease;
        transform: perspective(1000px) rotateX(5deg);
      }
      .image-container-styled:hover { box-shadow: 0 20px 50px rgba(0,0,0,0.4); transform: perspective(1000px) rotateX(2deg); }
      .image-container-styled img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
      .image-container-styled:hover img { transform: scale(1.1); }

      /* --- 首頁特殊樣式 --- */
      #title {
        /* [MODIFIED] 移除背景圖片，保留疊加層以確保文字可讀性 */
        background: linear-gradient(rgba(0, 0, 0, 0.45), rgba(0, 0, 0, 0.45));
        color: var(--accent-color);
      }
      /* [NEW] 新增背景影片樣式 */
      #bg-video {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        z-index: -1; /* 將影片置於內容之後 */
        object-fit: cover; /* 填滿容器，保持比例，可能裁切 */
      }
      #title .border-pattern {
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 40px solid transparent;
        border-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80"><path d="M0,0 L80,0 L80,80 L0,80 Z" fill="none" stroke="%23C5A56A" stroke-width="3"/><path d="M20,20 L60,20 L60,60 L20,60 Z" fill="none" stroke="%23C5A56A" stroke-width="2" stroke-dasharray="8,8"/></svg>') 40 stretch;
        pointer-events: none; z-index: 10;
      }
      #title h1 {
        font-family: 'Ma Shan Zheng', cursive; font-size: 8rem; font-weight: 700;
        margin-bottom: 25px; color: #F8F4E0; /* 亮米色 */
        text-shadow: 5px 5px 15px rgba(0, 0, 0, 0.9);
        letter-spacing: 3px; line-height: 1.1;
      }
      #title h2 {
        font-family: var(--elegant-font); font-size: 3rem; font-weight: 400;
        margin-bottom: 50px; color: var(--accent-color);
        letter-spacing: 3px; text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
      }
      .copyright-notice {
        position: absolute; bottom: 25px; left: 30px;
        transform: none; font-size: 16px; color: var(--accent-color);
        background-color: rgba(0, 0, 0, 0.5); padding: 10px 22px; 
        border-radius: 12px; z-index: 30;
        font-family: var(--elegant-font); letter-spacing: 1px;
      }
      .title-content { position: relative; z-index: 20; text-align: center; padding: 60px; max-width: 1400px; margin: 0 auto; }
      .title-subtitle {
        font-size: 2rem; margin-top: 70px; font-family: var(--cursive-font);
        letter-spacing: 2px; text-shadow: 3px 3px 8px rgba(0,0,0,0.8);
        line-height: 1.7; max-width: 900px; margin: 70px auto 0;
      }

      /* --- Section Backgrounds & Readability --- */
      .slide-section { background-size: cover; background-position: center center; background-attachment: fixed; }
      #overview { background: linear-gradient(rgba(20, 5, 0, 0.28), rgba(20, 5, 0, 0.28)), url('https://previews.123rf.com/images/manganganath/manganganath1311/manganganath131100062/23396895-the-nine-dragon-wall-at-the-forbidden-city-in-beijing.jpg') center center/cover; }
      #timeline { background: linear-gradient(rgba(20, 5, 0, 0.28), rgba(20, 5, 0, 0.28)), url('https://picx.zhimg.com/v2-6d5db91462a03de6d0d966e8f124206a_r.jpg?source=172ae18b') center center/cover; }
      #territory { background: linear-gradient(rgba(20, 5, 0, 0.3), rgba(20, 5, 0, 0.3)), url('https://upload.wikimedia.org/wikipedia/commons/0/08/Ming_Dynasty_map.png') center center/cover; }
      #emperors { background: linear-gradient(rgba(20, 5, 0, 0.25), rgba(20, 5, 0, 0.25)), url('https://img.soundofhope.org/2021-08/59c8-imfiehq2990015-1629735108100.jpg') center center/cover; }
      #government { background: linear-gradient(rgba(20, 5, 0, 0.25), rgba(20, 5, 0, 0.25)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Badge_%28Hyungbae%29_of_the_Upper_Civil_Rank_with_Two_Cranes_LACMA_M.2000.15.198.jpg/1200px-Badge_%28Hyungbae%29_of_the_Upper_Civil_Rank_with_Two_Cranes_LACMA_M.2000.15.198.jpg') center center/cover; }
      #culture { background: linear-gradient(rgba(20, 5, 0, 0.25), rgba(20, 5, 0, 0.25)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/P1030965_%282588357873%29.jpg/640px-P1030965_%282588357873%29.jpg') center center/cover; }
      #exchange { background: linear-gradient(rgba(20, 5, 0, 0.25), rgba(20, 5, 0, 0.25)), url('https://lens.usercontent.google.com/image?vsrid=CJqc8aH_55CTzwEQAhgBIiRlNjZhOTMzOS03NTg3LTQwZDktYTFlZi00ZTQ3MzI1ZmQxMjEyBiICdHAoKzjw5dGWtviOAw&gsessionid=enfgHPxCYsilrXfG5GX8GqfcMSGMqavyE_TcuEP2eQSYemSlt5GgZg') center center/cover; }
      #scholars { background: linear-gradient(rgba(20, 5, 0, 0.2), rgba(20, 5, 0, 0.2)), url('https://picx.zhimg.com/v2-27ab553e12305350954de844a1b54fdd_1440w.jpg') center center/cover; }
      #decline { background: linear-gradient(rgba(20, 5, 0, 0.2), rgba(20, 5, 0, 0.2)), url('https://img-baofun.zhhainiao.com/pcwallpaper_ugc/scene/267569c58c1e3ec1428a7d8c03e19573.jpg') center center/cover; }
      #legacy { background: linear-gradient(rgba(20, 5, 0, 0.2), rgba(20, 5, 0, 0.2)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Sunset_of_the_Forbidden_City_2006.JPG/640px-Sunset_of_the_Forbidden_City_2006.JPG') center center/cover; }
      #yongle-video { background: linear-gradient(rgba(20, 5, 0, 0.2), rgba(20, 5, 0, 0.2)), url('https://upload.wikimedia.org/wikipedia/commons/d/d7/Yongle_Dadian_encyclopedia_-_Preserved_in_the_British_Library_Or.11265_f.1v.jpg') center center/cover; }
      
      /* --- 保護卡片內的文字顏色 --- */
      .timeline-content, .styled-card, .info-card, .quote-block { text-shadow: none; }
      .timeline-content *, .styled-card *, .info-card *, .quote-block * { text-shadow: none; }
      .timeline-content, .styled-card { color: var(--text-color); }
      .timeline-content h3, .styled-card .text-red-800, .info-card .text-red-800 { color: var(--primary-color); }
      
      /* --- 針對特定元素的精細調整 --- */
      .info-card {
        background: linear-gradient(145deg, rgba(253, 251, 245, 0.95), rgba(234, 224, 200, 0.4)) !important;
        backdrop-filter: blur(5px); color: var(--text-color); border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.12); padding: 30px;
      }
      .info-card li { color: var(--text-color); }
      .info-card .text-yellow-600 { color: #b49156; } /* 調整為主題色 */
      .info-card .text-red-800 { color: var(--primary-color); }
      .text-sm { color: var(--text-color); opacity: 0.85; }
      
      /* --- 引言區塊 --- */
      .quote-block {
        background: linear-gradient(135deg, rgba(40, 10, 8, 0.7), rgba(60, 15, 12, 0.7));
        border-color: var(--accent-color); border-left: 10px solid var(--accent-color);
        padding: 35px; border-radius: 15px; max-width: 900px; margin: 50px auto;
        backdrop-filter: blur(5px);
      }
      .quote-block p { color: var(--accent-light); text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
      
      /* 新增元素：明代風格装饰 (龍紋) */
      .tang-decoration {
        position: absolute; width: 150px; height: 150px;
        opacity: 0.15; z-index: 1; background-size: contain; background-repeat: no-repeat;
      }
      .decoration-1 { top: 30px; left: 30px; background-image: url('https://png.pngtree.com/png-vector/20220612/ourmid/pngtree-chinese-style-auspicious-clouds-and-dragon-patterns-png-image_4960351.png'); }
      .decoration-2 { bottom: 30px; right: 30px; transform: rotate(180deg); background-image: url('https://png.pngtree.com/png-vector/20220612/ourmid/pngtree-chinese-style-auspicious-clouds-and-dragon-patterns-png-image_4960351.png'); }
      .decoration-3 { top: 40%; right: 5%; width: 120px; height: 120px; background-image: url('https://png.pngtree.com/png-vector/20220612/ourmid/pngtree-chinese-style-auspicious-clouds-and-dragon-patterns-png-image_4960351.png'); opacity: 0.1; transform: rotate(25deg); }
      .decoration-4 { bottom: 30%; left: 5%; width: 100px; height: 100px; background-image: url('https://png.pngtree.com/png-vector/20220612/ourmid/pngtree-chinese-style-auspicious-clouds-and-dragon-patterns-png-image_4960351.png'); opacity: 0.1; transform: rotate(-15deg); }
      
      /* 士人卡片特殊样式 */
      .scholar-card {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(234, 224, 200, 0.3));
        border-radius: 20px; overflow: hidden;
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 12px 30px rgba(0,0,0,0.15); position: relative; height: 100%;
      }
      .scholar-card:hover { transform: translateY(-15px) rotate(1.5deg); box-shadow: 0 20px 45px rgba(0,0,0,0.25); }
      .scholar-img { height: 280px; overflow: hidden; position: relative; }
      .scholar-img img { width: 100%; height: 100%; object-fit: cover; object-position: top; transition: transform 0.6s ease; }
      .scholar-card:hover .scholar-img img { transform: scale(1.15); }
      .scholar-content { padding: 25px; }
      .scholar-name { font-family: var(--title-font); font-size: 28px; color: var(--primary-color); margin-bottom: 10px; border-bottom: 2px solid var(--accent-light); padding-bottom: 8px; }
      .scholar-desc { font-family: var(--elegant-font); font-size: 17px; line-height: 1.8; color: var(--text-color); }
      
      /* 响应式调整 */
      @media (max-width: 1024px) { .section-title { font-size: 3.8rem; } .nav-links { gap: 8px 20px; } .nav-links a { padding: 8px 16px; font-size: 17px; } }
      @media (max-width: 768px) {
        .section-title { font-size: 3.2rem; padding: 0 20px 20px; }
        .slide-section { padding: 180px 25px 60px; }
        #title h1 { font-size: 6rem; } #title h2 { font-size: 2.5rem; } .title-subtitle { font-size: 1.8rem; }
        .content-container { padding: 30px; }
        .timeline-container { width: 100%; padding: 10px 30px 10px 60px; left: 0 !important; }
        .timeline-container::after { left: 25px !important; right: auto !important; }
        .visual-timeline::after { left: 30px; }
        .control-panel { top: auto; bottom: 20px; right: 15px; }
        .control-btn { width: 48px; height: 48px; font-size: 20px; }
      }
      @media (max-width: 480px) {
        .section-title { font-size: 2.8rem; }
        #title h1 { font-size: 4.5rem; } #title h2 { font-size: 2rem; }
        .title-subtitle { font-size: 1.5rem; margin-top: 50px; }
        .copyright-notice { font-size: 14px; left: 15px; bottom: 15px; }
        .nav-links a { padding: 7px 14px; font-size: 16px; }
        .content-container { padding: 20px; }
      }
    </style>
</head>
<body class="silk-scroll-effect">

    <!-- 背景音樂播放器 (移除 src 和 loop) -->
    <audio id="bg-music"></audio>

    <!-- 導覽列 -->
    <nav class="navbar">
      <div class="nav-links">
        <a href="#title" data-lang-key="nav_home">首頁</a>
        <a href="#overview" data-lang-key="nav_overview">王朝總覽</a>
        <a href="#timeline" data-lang-key="nav_timeline">大事年表</a>
        <a href="#territory" data-lang-key="nav_territory">疆域與地理</a>
        <a href="#emperors" data-lang-key="nav_emperors">重要皇帝</a>
        <a href="#government" data-lang-key="nav_government">政府與制度</a>
        <a href="#culture" data-lang-key="nav_culture">文化藝術</a>
        <a href="#exchange" data-lang-key="nav_exchange">國際交流</a>
        <a href="#scholars" data-lang-key="nav_scholars">士人與科技</a>
        <a href="#decline" data-lang-key="nav_decline">明末衰亡</a>
        <a href="#legacy" data-lang-key="nav_legacy">歷史遺產</a>
        <a href="#yongle-video" data-lang-key="nav_yongle_video">永樂大典影音專區</a>
      </div>
    </nav>

    <!-- 控制面板 -->
    <div class="control-panel">
      <button id="lang-toggle" class="control-btn" title="切換語言 / Language"><i class="fas fa-language"></i></button>
      <button id="autoplay-toggle" class="control-btn" title="自動播放 / Autoplay"><i class="fas fa-play"></i></button>
      <button id="fullscreen-toggle" class="control-btn" title="全螢幕 / Fullscreen"><i class="fas fa-expand"></i></button>
      <button id="music-toggle" class="control-btn" title="背景音樂 / Music"><i class="fas fa-volume-mute"></i></button>
      <button id="to-top-btn" class="control-btn" title="回到頂部 / Back to Top"><i class="fas fa-arrow-up"></i></button>
    </div>

    <!-- 主要內容區域 -->
    <main>

      <!-- 區塊 1: 標題頁 -->
      <section id="title" class="slide-section">
        <!-- [NEW] 背景影片 -->
        <video autoplay loop muted playsinline id="bg-video">
            <source src="https://ping763573.github.io/history/04.mp4" type="video/mp4">
            您的瀏覽器不支援影片標籤。
        </video>

        <div class="border-pattern"></div>
        <div class="tang-decoration decoration-1"></div>
        <div class="tang-decoration decoration-2"></div>
        <div class="tang-decoration decoration-3"></div>
        <div class="tang-decoration decoration-4"></div>
        <div class="title-content">
          <h1 data-lang-key="title_main">大明盛世<br>The Ming Dynasty</h1>
          <div style="font-size: 2.5rem; font-weight: 600; color: var(--accent-color); margin-top: 15px; letter-spacing: 3px; font-family: var(--elegant-font);" data-lang-key="title_dates">西元 1368－1644 年</div>
          <h2 data-lang-key="title_subtitle">從朱元璋開國到崇禎殉國</h2>
          <p class="title-subtitle" data-lang-key="title_presenter">一場關於權力、探索與傳承的全面解析<br>大學歷史課程</p>
        </div>
        <p class="copyright-notice" data-lang-key="copyright">展示照片與配樂其版權屬原創所有；純分享勿商用。</p>
      </section>

      <!-- 區塊 2: 王朝總覽 -->
      <section id="overview" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="overview_title">王朝總覽：集權的巔峰</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-3/5 scroll-reveal">
                <p class="text-xl leading-loose mb-6" data-lang-key="overview_p1">明朝（西元1368-1644年）是中國歷史上由漢族建立的最後一個大一統王朝。它上承元朝，下啟清朝，歷經二百七十六年。明朝以其強大的中央集權、宏偉的建築工程和複雜的社會制度而聞名。</p>
                <p class="text-xl leading-loose" data-lang-key="overview_p2">從驅逐蒙元、恢復漢族統治，到鄭和下西洋的海洋探索，再到晚期的內憂外患，明朝的歷史充滿了矛盾與輝煌，為後世留下了豐富的政治與文化遺產。</p>
                <div class="info-card border-l-4 border-red-800 p-6 mt-8 rounded-lg">
                  <h3 class="font-bold text-2xl text-red-800 mb-4" data-lang-key="overview_key_title">核心特徵</h3>
                  <ul class="list-none p-0 space-y-3">
                    <li class="text-lg flex items-start"><i class="fas fa-gavel text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_1">漢族統治復興，驅逐元朝</span></li>
                    <li class="text-lg flex items-start"><i class="fas fa-landmark text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_2">封建君主集權達到頂峰，廢除丞相</span></li>
                    <li class="text-lg flex items-start"><i class="fas fa-ship text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_3">鄭和下西洋，展示國力與朝貢貿易</span></li>
                    <li class="text-lg flex items-start"><i class="fas fa-user-secret text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_4">宦官干政與特務統治（錦衣衛、東廠）</span></li>
                    <li class="text-lg flex items-start"><i class="fas fa-yen-sign text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_5">前期重農抑商，後期資本主義萌芽</span></li>
                  </ul>
                </div>
              </div>
              <div class="lg:w-2/5 scroll-reveal" style="transition-delay: 0.2s;">
                <div class="image-container-styled h-full">
                  <img src="https://p2.img.cctvpic.com/photoAlbum/photo/2022/04/22/PHOTSk1S3X2FeNuGPLpBFaWh220422_1000x2000.jpg" alt="南京明故宮遺址" onerror="this.onerror=null;this.src='https://placehold.co/600x800/8C1B17/FDFBF5?text=明故宮遺址'">
                </div>
                <p class="text-sm italic mt-3 text-right" data-lang-key="overview_img_caption">南京明故宮遺址，見證了大明王朝開國的雄心與氣魄。</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 3: 大事年表 -->
      <section id="timeline" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="timeline_title">大明王朝興衰史</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="visual-timeline">
              <!-- Timeline items -->
              <div class="timeline-container left scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_1_title">1368年: 洪武開國</h3><p data-lang-key="timeline_1_desc">朱元璋在應天府（南京）稱帝，國號大明，年號洪武。北伐驅逐元順帝，結束蒙古在中原的統治。</p></div></div>
              <div class="timeline-container right scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_2_title">1405年: 鄭和下西洋</h3><p data-lang-key="timeline_2_desc">明成祖朱棣派遣鄭和率領龐大船隊首次出使西洋，此後二十餘年間七下西洋，宣揚國威，發展朝貢貿易。</p></div></div>
              <div class="timeline-container left scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_3_title">1449年: 土木堡之變</h3><p data-lang-key="timeline_3_desc">明英宗親征瓦剌，在土木堡遭遇慘敗，英宗被俘。此事件是明朝由盛轉衰的標誌性節點。</p></div></div>
              <div class="timeline-container right scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_4_title">1557年: 葡萄牙租借澳門</h3><p data-lang-key="timeline_4_desc">葡萄牙人以曝曬貨物為由，開始在澳門居住，標誌著西方勢力正式進入中國並建立長期據點。</p></div></div>
              <div class="timeline-container left scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_5_title">1616年: 後金崛起</h3><p data-lang-key="timeline_5_desc">努爾哈赤統一女真各部，建立後金（清朝前身），開始對明朝的遼東防線構成嚴重威脅。</p></div></div>
              <div class="timeline-container right scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_6_title">1644年: 甲申之變</h3><p data-lang-key="timeline_6_desc">李自成率領的農民軍攻陷北京，崇禎皇帝在煤山自縊，明朝滅亡。隨後清軍入關，開啟清代統治。</p></div></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 4: 疆域與地理 -->
      <section id="territory" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="territory_title">疆域與地理</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-3/5 scroll-reveal">
                <div class="map-container-interactive mx-auto image-container-styled">
                  <img src="https://k-static.appmobile.cn/uploads/ext/a/t0126155d3419220ad3.jpg" alt="Map of Ming Dynasty" onerror="this.onerror=null;this.src='https://placehold.co/800x600/8C1B17/FDFBF5?text=明朝疆域圖'">
                  <div class="hotspot" style="top: 59%; left: 75%;" data-target="info-nanjing"><i class="fas fa-star"></i></div>
                  <div class="hotspot" style="top: 45%; left: 73%;" data-target="info-beijing"><i class="fas fa-star"></i></div>
                  <div class="hotspot" style="top: 73%; left: 60%;" data-target="info-yunnan"><i class="fas fa-star"></i></div>
                  <div class="hotspot" style="top: 79%; left: 71%;" data-target="info-macau"><i class="fas fa-star"></i></div>
                  <div id="info-nanjing" class="info-box" style="top: 50%; left: 45%;"><h3 data-lang-key="map_nanjing_title">南京 (應天府)</h3><p data-lang-key="map_nanjing_desc">明朝開國首都，政治經濟中心。朱元璋在此奠定明初制度，明孝陵與明故宮是其重要遺存。</p></div>
                  <div id="info-beijing" class="info-box" style="top: 35%; left: 45%;"><h3 data-lang-key="map_beijing_title">北京 (順天府)</h3><p data-lang-key="map_beijing_desc">永樂年間遷都於此，稱「天子守國門」。紫禁城、天壇等宏偉建築在此修建，成為此後五百年的帝都。</p></div>
                  <div id="info-yunnan" class="info-box" style="top: 65%; left: 30%;"><h3 data-lang-key="map_yunnan_title">雲南</h3><p data-lang-key="map_yunnan_desc">明初通過軍事征服，將雲南完全納入版圖，設立行省，是明朝鞏固西南邊疆的重要成就。</p></div>
                  <div id="info-macau" class="info-box" style="top: 70%; left: 43%;"><h3 data-lang-key="map_macau_title">澳門</h3><p data-lang-key="map_macau_desc">明中葉後，葡萄牙人租借此地作為貿易據點，成為明朝與西方世界交流的重要窗口。</p></div>
                </div>
                <p class="text-sm italic mt-3 text-center" data-lang-key="territory_map_caption">圖為永樂時期明朝疆域圖。點擊地圖上的<i class="fas fa-star text-yellow-500"></i>圖標查看更多資訊。</p>
              </div>
              <div class="lg:w-2/5 scroll-reveal" style="transition-delay: 0.2s;">
                <p class="text-xl leading-loose mb-6" data-lang-key="territory_p1">明朝恢復了漢族在傳統疆域的統治，東北抵達外興安嶺，北控戈壁，西北至哈密，西南達雲貴高原。為防禦北方蒙古，修築了著名的明長城防線。</p>
                <div class="info-card p-6 rounded-lg">
                  <h3 class="font-bold text-2xl text-red-800 mb-4" data-lang-key="territory_stats_title">領土數據</h3>
                  <div class="space-y-3">
                    <div class="flex justify-between text-lg border-b border-dotted border-yellow-500 pb-2"><span class="font-semibold" data-lang-key="territory_stats_1a">永樂鼎盛疆域</span><span data-lang-key="territory_stats_1b">約650萬平方公里</span></div>
                    <div class="flex justify-between text-lg border-b border-dotted border-yellow-500 pb-2"><span class="font-semibold" data-lang-key="territory_stats_2a">晚明實際控制</span><span data-lang-key="territory_stats_2b">約350萬平方公里</span></div>
                    <div class="flex justify-between text-lg border-b border-dotted border-yellow-500 pb-2"><span class="font-semibold" data-lang-key="territory_stats_3a">鼎盛人口</span><span data-lang-key="territory_stats_3b">約1.5億 (1600年)</span></div>
                    <div class="flex justify-between text-lg"><span class="font-semibold" data-lang-key="territory_stats_4a">主要首都</span><span data-lang-key="territory_stats_4b">南京 (初期) / 北京 (永樂後)</span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 5: 重要皇帝 -->
      <section id="emperors" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="emperors_title">重要皇帝</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mt-4">
              <div class="styled-card scroll-reveal">
                <div class="image-container-styled mb-4" style="height: 250px;">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/Portrait_assis_de_l%27empereur_Ming_Taizu.jpg/1200px-Portrait_assis_de_l%27empereur_Ming_Taizu.jpg" alt="明太祖" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=明太祖'">
                </div>
                <div class="border-b-2 border-yellow-500 pb-2 mb-3">
                  <div class="text-3xl font-bold text-red-800" data-lang-key="emperor_1_name" style="font-family: var(--title-font);">明太祖 (朱元璋)</div>
                  <div class="text-gray-600" data-lang-key="emperor_1_reign">在位: 1368-1398</div>
                </div>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                  <li data-lang-key="emperor_1_feat1">布衣起兵，建立明朝</li>
                  <li data-lang-key="emperor_1_feat2">廢除丞相，高度中央集權</li>
                  <li data-lang-key="emperor_1_feat3">嚴刑峻法，整頓吏治</li>
                </ul>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.1s;">
                <div class="image-container-styled mb-4" style="height: 250px;">
                  <img src="https://img.dpm.org.cn/Uploads/Picture/dc/1468[1024].jpg" alt="明成祖" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=明成祖'">
                </div>
                <div class="border-b-2 border-yellow-500 pb-2 mb-3">
                  <div class="text-3xl font-bold text-red-800" data-lang-key="emperor_2_name" style="font-family: var(--title-font);">明成祖 (朱棣)</div>
                  <div class="text-gray-600" data-lang-key="emperor_2_reign">在位: 1402-1424</div>
                </div>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                  <li data-lang-key="emperor_2_feat1">靖難之役奪位，創永樂盛世</li>
                  <li data-lang-key="emperor_2_feat2">派遣鄭和下西洋，編修永樂大典</li>
                  <li data-lang-key="emperor_2_feat3">遷都北京，御駕親征蒙古</li>
                </ul>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.2s;">
                <div class="image-container-styled mb-4" style="height: 250px;">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/%E6%98%8E%E4%B8%96%E5%AE%97%E5%83%8F.jpg/250px-%E6%98%8E%E4%B8%96%E5%AE%97%E5%83%8F.jpg" alt="明世宗" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=明世宗'">
                </div>
                <div class="border-b-2 border-yellow-500 pb-2 mb-3">
                  <div class="text-3xl font-bold text-red-800" data-lang-key="emperor_3_name" style="font-family: var(--title-font);">明世宗 (嘉靖帝)</div>
                  <div class="text-gray-600" data-lang-key="emperor_3_reign">在位: 1521-1567</div>
                </div>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                  <li data-lang-key="emperor_3_feat1">引發「大禮議」之爭，強化皇權</li>
                  <li data-lang-key="emperor_3_feat2">長期不理朝政，沉迷道教</li>
                  <li data-lang-key="emperor_3_feat3">倭寇為患，邊防壓力大</li>
                </ul>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.3s;">
                <div class="image-container-styled mb-4" style="height: 250px;">
                  <img src="https://5b0988e595225.cdn.sohucs.com/q_70,c_zoom,w_640/images/20180811/b5c251cdb43c465c8765951cc545d09f.jpeg" alt="明思宗" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=明思宗'">
                </div>
                <div class="border-b-2 border-yellow-500 pb-2 mb-3">
                  <div class="text-3xl font-bold text-red-800" data-lang-key="emperor_4_name" style="font-family: var(--title-font);">明思宗 (崇禎帝)</div>
                  <div class="text-gray-600" data-lang-key="emperor_4_reign">在位: 1627-1644</div>
                </div>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                  <li data-lang-key="emperor_4_feat1">勤於政事，但生性多疑</li>
                  <li data-lang-key="emperor_4_feat2">在位期間內憂外患，天災不斷</li>
                  <li data-lang-key="emperor_4_feat3">國破後於煤山自縊，明朝滅亡</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 6: 政府與制度 -->
      <section id="government" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="gov_title">政府與制度</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-1/2 flex flex-col gap-8">
                <div class="styled-card scroll-reveal">
                  <h3 class="text-2xl text-red-800 mb-3 flex items-center font-bold"><i class="fas fa-university mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="gov_box1_title">中央六部制</span></h3>
                  <p class="leading-relaxed" data-lang-key="gov_box1_desc">明太祖廢除丞相和中書省，將權力集中於皇帝。國家行政由吏、戶、禮、兵、刑、工六部分理，直接對皇帝負責，君主專制達到頂峰。</p>
                </div>
                <div class="styled-card scroll-reveal" style="transition-delay: 0.1s;">
                  <h3 class="text-2xl text-red-800 mb-3 flex items-center font-bold"><i class="fas fa-user-secret mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="gov_box2_title">錦衣衛與廠衛特務</span></h3>
                  <p class="leading-relaxed" data-lang-key="gov_box2_desc">設立錦衣衛、東廠、西廠等特務機構，由皇帝和宦官直接控制，負責偵查、逮捕、審訊，用以監控官民，是皇權恐怖統治的工具。</p>
                </div>
                <div class="styled-card scroll-reveal" style="transition-delay: 0.2s;">
                  <h3 class="text-2xl text-red-800 mb-3 flex items-center font-bold"><i class="fas fa-fort-awesome mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="gov_box3_title">九邊重鎮與衛所制</span></h3>
                  <p class="leading-relaxed" data-lang-key="gov_box3_desc">為防禦北方蒙古，沿長城設立九個軍事重鎮。全國實行衛所制，軍隊屯田自給，但後期制度敗壞，軍備廢弛，戰力低下。</p>
                </div>
              </div>
              <div class="lg:w-1/2 scroll-reveal" style="transition-delay: 0.3s;">
                <div class="h-96 w-full p-4 bg-white/80 rounded-lg shadow-inner">
                  <canvas id="governmentChart"></canvas>
                </div>
                <p class="text-center mt-4 text-sm" data-lang-key="gov_chart_caption">圖表顯示明代中後期權力結構。文官集團（紅色）雖是行政主體，但宦官（金色）與錦衣衛（灰色）作為皇權的延伸，對政局產生了巨大影響。</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 7: 文化藝術 -->
      <section id="culture" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="culture_title">文化藝術</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <p class="text-center text-xl max-w-4xl mx-auto mb-12 scroll-reveal leading-relaxed" data-lang-key="culture_intro">明代文化在市民階層壯大的背景下，呈現出世俗化與多元化的趨勢。小說、戲曲等通俗文學蓬勃發展，工藝美術則以其精湛的技藝與華麗的風格著稱。</p>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
              <div class="styled-card flex flex-col md:flex-row bg-white overflow-hidden scroll-reveal">
                <div class="image-container-styled md:w-1/3 flex-shrink-0">
                  <img src="https://p9.itc.cn/q_70/images03/20230401/9b2d9a5752134c129a6ab28af626f18b.jpeg" alt="永樂大典" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=明代文學'">
                </div>
                <div class="p-5 flex flex-col justify-center flex-grow">
                  <h3 class="text-2xl text-red-800 font-bold mb-3 flex items-center"><i class="fas fa-book-open mr-3 text-yellow-600"></i><span data-lang-key="culture_card1_title">小說與典籍</span></h3>
                  <p data-lang-key="culture_card1_desc">長篇章回小說空前繁榮，《三國演義》、《水滸傳》、《西遊記》、《金瓶梅》四大奇書成書於此。官方編修的《永樂大典》更是曠世宏編。</p>
                </div>
              </div>
              <div class="styled-card flex flex-col md:flex-row bg-white overflow-hidden scroll-reveal" style="transition-delay: 0.1s;">
                <div class="image-container-styled md:w-1/3 flex-shrink-0">
                  <img src="https://theme.npm.edu.tw/3d/att/collection/04001095/17009580.jpg" alt="明代青花瓷" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=明代瓷器'">
                </div>
                <div class="p-5 flex flex-col justify-center flex-grow">
                  <h3 class="text-2xl text-red-800 font-bold mb-3 flex items-center"><i class="fas fa-palette mr-3 text-yellow-600"></i><span data-lang-key="culture_card2_title">青花瓷與戲曲</span></h3>
                  <p data-lang-key="culture_card2_desc">景德鎮成為世界瓷都，其燒製的青花瓷、鬥彩瓷等聞名遐邇。戲曲方面，源於崑山的崑曲成為「百戲之祖」，影響深遠。</p>
                  <div class="text-lg italic text-gray-700 mt-4 pl-4 border-l-4 border-yellow-500" data-lang-key="culture_card2_quote" style="font-family: var(--cursive-font);">"原來奼紫嫣紅開遍，似這般都付與斷井頹垣。" <br>— 湯顯祖《牡丹亭》</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 8: 國際交流 -->
      <section id="exchange" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="exchange_title">國際交流</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-2/5 scroll-reveal" style="transition-delay: 0.3s;">
                <div class="image-container-styled">
                    <img src="https://oss.gjrwls.com/cmsFiles/2024/1/09/20240109073347-678ace6b-8779-426d-9b65-9af77c6b9393.png" alt="鄭和下西洋路線圖" class="w-full rounded-lg bg-white p-2" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=鄭和航海圖'">
                </div>
                <p class="text-sm italic mt-3 text-center" data-lang-key="exchange_img_caption">鄭和七下西洋航海路線圖，是世界航海史上的壯舉。</p>
              </div>
              <div class="lg:w-3/5">
                <p class="text-xl leading-loose mb-8 scroll-reveal" data-lang-key="exchange_intro">明初採取積極的對外政策，以鄭和下西洋為代表，建立了龐大的朝貢體系。而中後期則轉為海禁政策，但民間與西方的走私貿易和文化交流從未間斷。</p>
                <div class="space-y-6">
                  <div class="styled-card scroll-reveal" style="transition-delay: 0.1s;">
                    <h3 class="text-xl font-bold text-red-800 mb-2 flex items-center"><i class="fas fa-ship mr-3 text-yellow-600"></i><span data-lang-key="exchange_box1_title">鄭和七下西洋</span></h3>
                    <p data-lang-key="exchange_box1_desc">從1405到1433年，鄭和率領寶船隊七次遠航，遍訪東南亞、印度洋，最遠抵達東非沿岸和紅海，是中國古代規模最大的遠洋航行活動。</p>
                  </div>
                  <div class="styled-card scroll-reveal" style="transition-delay: 0.2s;">
                    <h3 class="text-xl font-bold text-red-800 mb-2 flex items-center"><i class="fas fa-church mr-3 text-yellow-600"></i><span data-lang-key="exchange_box2_title">西學東漸</span></h3>
                    <p data-lang-key="exchange_box2_desc">明末，以利瑪竇為代表的耶穌會傳教士來華，不僅傳播天主教，還帶來了西方的天文、數學、地理等科學知識，開啟了中西文化交流的新篇章。</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 9: 士人與科技 -->
      <section id="scholars" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="scholars_title">士人與科技</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <p class="text-center text-xl max-w-4xl mx-auto mb-12 scroll-reveal leading-relaxed" data-lang-key="scholars_intro">明代中後期，在思想解放的潮流下，湧現出一批注重實學的士人。他們編寫了集大成的科學技術著作，反映了中國傳統科技發展的頂峰與總結。</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
              <div class="scholar-card scroll-reveal">
                <div class="scholar-img">
                  <img src="https://bucket-image.inkmaginecms.com/version/hd/5/image/2024/10/213b843f-6337-4478-a4f3-cb48fcbc8282.jpg" alt="徐光啟" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=徐光啟'">
                </div>
                <div class="scholar-content">
                  <h3 class="scholar-name" data-lang-key="scholar_1_name">徐光啟</h3>
                  <p class="scholar-desc" data-lang-key="scholar_1_desc">明末科學家、政治家。與利瑪竇合譯《幾何原本》，引進西方科學。其著作《農政全書》是中國古代農業科學的集大成之作。</p>
                </div>
              </div>
              <div class="scholar-card scroll-reveal" style="transition-delay: 0.1s;">
                <div class="scholar-img">
                  <img src="https://www.mychistory.com/images/2021/02/26/0210-2_large.jpeg" alt="李時珍" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=李時珍'">
                </div>
                <div class="scholar-content">
                  <h3 class="scholar-name" data-lang-key="scholar_2_name">李時珍</h3>
                  <p class="scholar-desc" data-lang-key="scholar_2_desc">醫藥學家。歷時近三十年，編成藥物學巨著《本草綱目》，收錄藥物近兩千種，附方萬餘條，被譽為「東方藥物巨典」。</p>
                </div>
              </div>
              <div class="scholar-card scroll-reveal" style="transition-delay: 0.2s;">
                <div class="scholar-img">
                  <img src="https://upload.wikimedia.org/wikipedia/gan/4/42/%E5%AE%8B%E6%87%89%E6%98%9F_%E5%B8%81.jpg" alt="宋應星" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=宋應星'">
                </div>
                <div class="scholar-content">
                  <h3 class="scholar-name" data-lang-key="scholar_3_name">宋應星</h3>
                  <p class="scholar-desc" data-lang-key="scholar_3_desc">明代科學家。其著作《天工開物》是世界上第一部關於農業和手工業生產的綜合性著作，被譽為「中國17世紀的工藝百科全書」。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 10: 明末衰亡 -->
      <section id="decline" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="decline_title">明末衰亡</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <p class="text-center text-xl max-w-4xl mx-auto mb-12 scroll-reveal leading-relaxed" data-lang-key="decline_intro">明朝的滅亡是政治腐敗、天災人禍、內憂外患交織的結果。從萬曆年間開始的怠政，到天啟年間的宦官專權，最終在崇禎時期，國家機器徹底崩潰。</p>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-1/2 scroll-reveal">
                <div class="image-container-styled h-full">
                  <img src="https://5b0988e595225.cdn.sohucs.com/q_70,c_zoom,w_640/images/20190424/e7c53b905bbd4c83b266ab5477311c2d.jpeg" alt="李自成攻北京" class="w-full rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/800x600?text=明末戰亂'">
                </div>
                <p class="text-sm italic mt-3 text-center" data-lang-key="decline_img_caption">描繪李自成農民軍圍攻北京城的畫作，反映了明末的動盪局勢。</p>
              </div>
              <div class="lg:w-1/2 flex flex-col gap-8 scroll-reveal" style="transition-delay: 0.2s;">
                <div class="styled-card">
                  <h3 class="text-2xl text-red-800 mb-3 flex items-center font-bold"><i class="fas fa-users-slash mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="decline_box1_title">黨爭與宦官專權</span></h3>
                  <p class="leading-relaxed" data-lang-key="decline_box1_desc">晚明時期，東林黨與閹黨之間的鬥爭消耗了大量國力。天啟年間，大宦官魏忠賢專擅朝政，迫害忠良，政治極度黑暗。</p>
                </div>
                <div class="styled-card">
                  <h3 class="text-2xl text-red-800 mb-3 flex items-center font-bold"><i class="fas fa-tractor mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="decline_box2_title">天災、民變與外患</span></h3>
                  <p class="leading-relaxed" data-lang-key="decline_box2_desc">明末恰逢小冰期，天災頻發，饑荒遍地。沉重的賦稅引發了李自成、張獻忠等大規模農民起義。同時，關外的後金（清）不斷蠶食明朝領土。</p>
                </div>
                <div class="styled-card">
                  <h3 class="text-2xl text-red-800 mb-3 flex items-center font-bold"><i class="fas fa-dungeon mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="decline_box3_title">崇禎殉國</span></h3>
                  <p class="leading-relaxed" data-lang-key="decline_box3_desc">1644年，李自成攻破北京，走投無路的崇禎皇帝在紫禁城後的煤山（今景山）上吊自盡，標誌著大明王朝的正式終結。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 11: 歷史遺產 -->
      <section id="legacy" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="legacy_title">歷史遺產</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <p class="text-center text-xl max-w-4xl mx-auto mb-12 scroll-reveal leading-relaxed" data-lang-key="legacy_intro">明朝不僅是中國歷史的關鍵轉折期，其留下的物質與非物質文化遺產，至今仍在深刻影響著中國乃至世界。從宏偉的建築到精美的藝術品，都是中華文明的瑰寶。</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
              <div class="styled-card scroll-reveal">
                <h3 class="text-xl font-bold text-red-800 mb-3 flex items-center"><i class="fas fa-landmark mr-3 text-yellow-600"></i><span data-lang-key="legacy_box1_title">建築遺產</span></h3>
                <p class="leading-relaxed" data-lang-key="legacy_box1_desc">北京故宮（紫禁城）和明十三陵是明代皇家建築的典範，被列為世界文化遺產。明長城則是人類歷史上最宏偉的軍事防禦工程。</p>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.1s;">
                <h3 class="text-xl font-bold text-red-800 mb-3 flex items-center"><i class="fas fa-globe-asia mr-3 text-yellow-600"></i><span data-lang-key="legacy_box2_title">制度與疆域遺產</span></h3>
                <p class="leading-relaxed" data-lang-key="legacy_box2_desc">明朝確立的行省制度和中央集權模式，為清朝所繼承。其奠定的疆域，特別是對西南、東北的管轄，構成了現代中國版圖的基礎。</p>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.2s;">
                <h3 class="text-xl font-bold text-red-800 mb-3 flex items-center"><i class="fas fa-gem mr-3 text-yellow-600"></i><span data-lang-key="legacy_box3_title">工藝與文化影響</span></h3>
                <p class="leading-relaxed" data-lang-key="legacy_box3_desc">景德鎮的瓷器燒造技術影響了全球，明式家具以其簡約、典雅的設計成為古典家具的巔峰。四大奇書等文學作品至今仍是華人世界的文化經典。</p>
              </div>
            </div>
            <div class="quote-block p-8 my-8 scroll-reveal rounded-lg">
              <p class="text-2xl italic leading-relaxed" data-lang-key="legacy_quote">"天子守國門，君王死社稷。"</p>
              <p class="text-right font-semibold mt-4 text-lg" data-lang-key="legacy_quote_author">— 後世對明朝北京建都與崇禎殉國的評價</p>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 12: 永樂大典影音專區 -->
      <section id="yongle-video" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="yongle_video_title">永樂大典影音專區</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            
            <!-- Responsive Embed for YouTube -->
            <div class="scroll-reveal my-8" style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; border-radius: 15px; box-shadow: 0 15px 40px rgba(0,0,0,0.3); border: 3px solid var(--accent-light);">
              <iframe 
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                src="https://www.youtube.com/embed/qWX_9ahqHtI" 
                title="YouTube video player" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
              </iframe>
            </div>

            <p class="text-xl leading-loose max-w-4xl mx-auto mt-10 scroll-reveal" data-lang-key="yongle_video_desc">
              <!-- Content will be injected by JavaScript -->
            </p>
          </div>
        </div>
      </section>

    </main>

    <script>
    // --- 翻譯資料 ---
    const translations = {
      'zh-TW': {
        nav_home: '首頁', nav_overview: '王朝總覽', nav_timeline: '大事年表', nav_territory: '疆域與地理', nav_emperors: '重要皇帝', nav_government: '政府與制度', nav_culture: '文化藝術', nav_exchange: '國際交流', nav_scholars: '士人與科技', nav_decline: '明末衰亡', nav_legacy: '歷史遺產', nav_yongle_video: '永樂大典影音專區',
        title_main: '大明盛世<br>The Ming Dynasty', title_dates: '西元 1368－1644 年', title_subtitle: '從朱元璋開國到崇禎殉國', title_presenter: '一場關於權力、探索與傳承的全面解析<br>大學歷史課程',
        copyright: '展示照片與配樂其版權屬原創所有；純分享勿商用。',
        tts_play_btn: '🔊 語音導讀', tts_stop_btn: '⏹️ 停止導讀',
        overview_title: '王朝總覽：集權的巔峰',
        overview_p1: '明朝（西元1368-1644年）是中國歷史上由漢族建立的最後一個大一統王朝。它上承元朝，下啟清朝，歷經二百七十六年。明朝以其強大的中央集權、宏偉的建築工程和複雜的社會制度而聞名。',
        overview_p2: '從驅逐蒙元、恢復漢族統治，到鄭和下西洋的海洋探索，再到晚期的內憂外患，明朝的歷史充滿了矛盾與輝煌，為後世留下了豐富的政治與文化遺產。',
        overview_key_title: '核心特徵',
        overview_key_1: '漢族統治復興，驅逐元朝', overview_key_2: '封建君主集權達到頂峰，廢除丞相', overview_key_3: '鄭和下西洋，展示國力與朝貢貿易', overview_key_4: '宦官干政與特務統治（錦衣衛、東廠）', overview_key_5: '前期重農抑商，後期資本主義萌芽',
        overview_img_caption: '南京明故宮遺址，見證了大明王朝開國的雄心與氣魄。',
        timeline_title: '大明王朝興衰史',
        timeline_1_title: '1368年: 洪武開國', timeline_1_desc: '朱元璋在應天府（南京）稱帝，國號大明，年號洪武。北伐驅逐元順帝，結束蒙古在中原的統治。',
        timeline_2_title: '1405年: 鄭和下西洋', timeline_2_desc: '明成祖朱棣派遣鄭和率領龐大船隊首次出使西洋，此後二十餘年間七下西洋，宣揚國威，發展朝貢貿易。',
        timeline_3_title: '1449年: 土木堡之變', timeline_3_desc: '明英宗親征瓦剌，在土木堡遭遇慘敗，英宗被俘。此事件是明朝由盛轉衰的標誌性節點。',
        timeline_4_title: '1557年: 葡萄牙租借澳門', timeline_4_desc: '葡萄牙人以曝曬貨物為由，開始在澳門居住，標誌著西方勢力正式進入中國並建立長期據點。',
        timeline_5_title: '1616年: 後金崛起', timeline_5_desc: '努爾哈赤統一女真各部，建立後金（清朝前身），開始對明朝的遼東防線構成嚴重威脅。',
        timeline_6_title: '1644年: 甲申之變', timeline_6_desc: '李自成率領的農民軍攻陷北京，崇禎皇帝在煤山自縊，明朝滅亡。隨後清軍入關，開啟清代統治。',
        territory_title: '疆域與地理',
        territory_map_caption: '圖為永樂時期明朝疆域圖。點擊地圖上的<i class="fas fa-star text-yellow-500"></i>圖標查看更多資訊。',
        territory_p1: '明朝恢復了漢族在傳統疆域的統治，東北抵達外興安嶺，北控戈壁，西北至哈密，西南達雲貴高原。為防禦北方蒙古，修築了著名的明長城防線。',
        territory_stats_title: '領土數據',
        territory_stats_1a: '永樂鼎盛疆域', territory_stats_1b: '約650萬平方公里',
        territory_stats_2a: '晚明實際控制', territory_stats_2b: '約350萬平方公里',
        territory_stats_3a: '鼎盛人口', territory_stats_3b: '約1.5億 (1600年)',
        territory_stats_4a: '主要首都', territory_stats_4b: '南京 (初期) / 北京 (永樂後)',
        map_nanjing_title: '南京 (應天府)', map_nanjing_desc: '明朝開國首都，政治經濟中心。朱元璋在此奠定明初制度，明孝陵與明故宮是其重要遺存。',
        map_beijing_title: '北京 (順天府)', map_beijing_desc: '永樂年間遷都於此，稱「天子守國門」。紫禁城、天壇等宏偉建築在此修建，成為此後五百年的帝都。',
        map_yunnan_title: '雲南', map_yunnan_desc: '明初通過軍事征服，將雲南完全納入版圖，設立行省，是明朝鞏固西南邊疆的重要成就。',
        map_macau_title: '澳門', map_macau_desc: '明中葉後，葡萄牙人租借此地作為貿易據點，成為明朝與西方世界交流的重要窗口。',
        emperors_title: '重要皇帝',
        emperor_1_name: '明太祖 (朱元璋)', emperor_1_reign: '在位: 1368-1398', emperor_1_feat1: '布衣起兵，建立明朝', emperor_1_feat2: '廢除丞相，高度中央集權', emperor_1_feat3: '嚴刑峻法，整頓吏治',
        emperor_2_name: '明成祖 (朱棣)', emperor_2_reign: '在位: 1402-1424', emperor_2_feat1: '靖難之役奪位，創永樂盛世', emperor_2_feat2: '派遣鄭和下西洋，編修永樂大典', emperor_2_feat3: '遷都北京，御駕親征蒙古',
        emperor_3_name: '明世宗 (嘉靖帝)', emperor_3_reign: '在位: 1521-1567', emperor_3_feat1: '引發「大禮議」之爭，強化皇權', emperor_3_feat2: '長期不理朝政，沉迷道教', emperor_3_feat3: '倭寇為患，邊防壓力大',
        emperor_4_name: '明思宗 (崇禎帝)', emperor_4_reign: '在位: 1627-1644', emperor_4_feat1: '勤於政事，但生性多疑', emperor_4_feat2: '在位期間內憂外患，天災不斷', emperor_4_feat3: '國破後於煤山自縊，明朝滅亡',
        gov_title: '政府與制度',
        gov_box1_title: '中央六部制', gov_box1_desc: '明太祖廢除丞相和中書省，將權力集中於皇帝。國家行政由吏、戶、禮、兵、刑、工六部分理，直接對皇帝負責，君主專制達到頂峰。',
        gov_box2_title: '錦衣衛與廠衛特務', gov_box2_desc: '設立錦衣衛、東廠、西廠等特務機構，由皇帝和宦官直接控制，負責偵查、逮捕、審訊，用以監控官民，是皇權恐怖統治的工具。',
        gov_box3_title: '九邊重鎮與衛所制', gov_box3_desc: '為防禦北方蒙古，沿長城設立九個軍事重鎮。全國實行衛所制，軍隊屯田自給，但後期制度敗壞，軍備廢弛，戰力低下。',
        gov_chart_caption: '圖表顯示明代中後期權力結構。文官集團（紅色）雖是行政主體，但宦官（金色）與錦衣衛（灰色）作為皇權的延伸，對政局產生了巨大影響。',
        culture_title: '文化藝術',
        culture_intro: '明代文化在市民階層壯大的背景下，呈現出世俗化與多元化的趨勢。小說、戲曲等通俗文學蓬勃發展，工藝美術則以其精湛的技藝與華麗的風格著稱。',
        culture_card1_title: '小說與典籍', culture_card1_desc: '長篇章回小說空前繁榮，《三國演義》、《水滸傳》、《西遊記》、《金瓶梅》四大奇書成書於此。官方編修的《永樂大典》更是曠世宏編。',
        culture_card2_title: '青花瓷與戲曲', culture_card2_desc: '景德鎮成為世界瓷都，其燒製的青花瓷、鬥彩瓷等聞名遐邇。戲曲方面，源於崑山的崑曲成為「百戲之祖」，影響深遠。',
        culture_card2_quote: '"原來奼紫嫣紅開遍，似這般都付與斷井頹垣。" <br>— 湯顯祖《牡丹亭》',
        exchange_title: '國際交流',
        exchange_intro: '明初採取積極的對外政策，以鄭和下西洋為代表，建立了龐大的朝貢體系。而中後期則轉為海禁政策，但民間與西方的走私貿易和文化交流從未間斷。',
        exchange_box1_title: '鄭和七下西洋', exchange_box1_desc: '從1405到1433年，鄭和率領寶船隊七次遠航，遍訪東南亞、印度洋，最遠抵達東非沿岸和紅海，是中國古代規模最大的遠洋航行活動。',
        exchange_box2_title: '西學東漸', exchange_box2_desc: '明末，以利瑪竇為代表的耶穌會傳教士來華，不僅傳播天主教，還帶來了西方的天文、數學、地理等科學知識，開啟了中西文化交流的新篇章。',
        exchange_img_caption: '鄭和七下西洋航海路線圖，是世界航海史上的壯舉。',
        scholars_title: '士人與科技',
        scholars_intro: '明代中後期，在思想解放的潮流下，湧現出一批注重實學的士人。他們編寫了集大成的科學技術著作，反映了中國傳統科技發展的頂峰與總結。',
        scholar_1_name: '徐光啟', scholar_1_desc: '明末科學家、政治家。與利瑪竇合譯《幾何原本》，引進西方科學。其著作《農政全書》是中國古代農業科學的集大成之作。',
        scholar_2_name: '李時珍', scholar_2_desc: '醫藥學家。歷時近三十年，編成藥物學巨著《本草綱目》，收錄藥物近兩千種，附方萬餘條，被譽為「東方藥物巨典」。',
        scholar_3_name: '宋應星', scholar_3_desc: '明代科學家。其著作《天工開物》是世界上第一部關於農業和手工業生產的綜合性著作，被譽為「中國17世紀的工藝百科全書」。',
        decline_title: '明末衰亡',
        decline_intro: '明朝的滅亡是政治腐敗、天災人禍、內憂外患交織的結果。從萬曆年間開始的怠政，到天啟年間的宦官專權，最終在崇禎時期，國家機器徹底崩潰。',
        decline_img_caption: '描繪李自成農民軍圍攻北京城的畫作，反映了明末的動盪局勢。',
        decline_box1_title: '黨爭與宦官專權', decline_box1_desc: '晚明時期，東林黨與閹黨之間的鬥爭消耗了大量國力。天啟年間，大宦官魏忠賢專擅朝政，迫害忠良，政治極度黑暗。',
        decline_box2_title: '天災、民變與外患', decline_box2_desc: '明末恰逢小冰期，天災頻發，饑荒遍地。沉重的賦稅引發了李自成、張獻忠等大規模農民起義。同時，關外的後金（清）不斷蠶食明朝領土。',
        decline_box3_title: '崇禎殉國', decline_box3_desc: '1644年，李自成攻破北京，走投無路的崇禎皇帝在紫禁城後的煤山（今景山）上吊自盡，標誌著大明王朝的正式終結。',
        legacy_title: '歷史遺產',
        legacy_intro: '明朝不僅是中國歷史的關鍵轉折期，其留下的物質與非物質文化遺產，至今仍在深刻影響著中國乃至世界。從宏偉的建築到精美的藝術品，都是中華文明的瑰寶。',
        legacy_box1_title: '建築遺產', legacy_box1_desc: '北京故宮（紫禁城）和明十三陵是明代皇家建築的典範，被列為世界文化遺產。明長城則是人類歷史上最宏偉的軍事防禦工程。',
        legacy_box2_title: '制度與疆域遺產', legacy_box2_desc: '明朝確立的行省制度和中央集權模式，為清朝所繼承。其奠定的疆域，特別是對西南、東北的管轄，構成了現代中國版圖的基礎。',
        legacy_box3_title: '工藝與文化影響', legacy_box3_desc: '景德鎮的瓷器燒造技術影響了全球，明式家具以其簡約、典雅的設計成為古典家具的巔峰。四大奇書等文學作品至今仍是華人世界的文化經典。',
        legacy_quote: '"天子守國門，君王死社稷。"',
        legacy_quote_author: '— 後世對明朝北京建都與崇禎殉國的評價',
        yongle_video_title: '永樂大典影音專區',
        yongle_video_desc: '<strong>關於《永樂大典》</strong><br><br>《永樂大典》是明成祖朱棣下令編纂的一部類書，是中國古代規模最大的百科全書。全書共22,937卷，分裝11,095冊，約3.7億字，匯集了明代以前的圖書文獻七八千種。<br><br>其編纂動員了全國數千名學者，歷時五年完成。內容涵蓋經、史、子、集、百家、天文、地理、醫卜、僧道、技藝等各門類知識。它不僅保存了大量元代及以前的珍貴文獻，也體現了明初的文化自信與國力鼎盛。可惜的是，正本下落不明，副本也在明末清末的戰亂中大多散佚，如今存世的僅有四百餘冊，散落世界各地，成為中華文化的無價之寶。',
        chart_gov_title: '明代中後期權力結構 (示意圖)',
        chart_gov_label_civil: '文官集團', chart_gov_label_eunuch: '宦官集團', chart_gov_label_secret: '錦衣衛',
        chart_gov_yaxis: '相對影響力指數',
        chart_rel_title: '鄭和下西洋交流網絡',
        chart_rel_label: '交流強度', chart_rel_cats: ['朝鮮/日本', '東南亞', '印度', '波斯/阿拉伯', '東非'],
      },
      'en': {
        nav_home: 'Home', nav_overview: 'Overview', nav_timeline: 'Timeline', nav_territory: 'Territory', nav_emperors: 'Emperors', nav_government: 'Government', nav_culture: 'Culture & Art', nav_exchange: 'Exchange', nav_scholars: 'Scholars & Tech', nav_decline: 'Decline', nav_legacy: 'Legacy', nav_yongle_video: 'Yongle Encyclopedia',
        title_main: 'The Great Ming<br>The Ming Dynasty', title_dates: '1368 - 1644 CE', title_subtitle: 'From Zhu Yuanzhang\'s Founding to Chongzhen\'s Fall', title_presenter: 'A Comprehensive Analysis of Power, Exploration, and Heritage<br>University History Course',
        copyright: 'The copyright of photos and music belongs to the original creators. For sharing purposes only, not for commercial use.',
        tts_play_btn: '🔊 Read Aloud', tts_stop_btn: '⏹️ Stop Reading',
        overview_title: 'Dynasty Overview: The Zenith of Centralization',
        overview_p1: 'The Ming Dynasty (1368-1644 CE) was the last great dynasty in Chinese history established by the Han people. It succeeded the Yuan Dynasty and preceded the Qing Dynasty, lasting for 276 years. The Ming is renowned for its powerful centralized government, magnificent construction projects, and complex social systems.',
        overview_p2: 'From expelling the Mongols and restoring Han rule, to the maritime explorations of Zheng He, and the internal and external troubles of its later years, the history of the Ming is filled with contradictions and brilliance, leaving a rich political and cultural legacy for posterity.',
        overview_key_title: 'Key Characteristics',
        overview_key_1: 'Restoration of Han Chinese rule, expulsion of the Yuan', overview_key_2: 'Feudal monarchy reached its peak, abolition of the chancellorship', overview_key_3: 'Zheng He\'s voyages, displaying national power and tribute trade', overview_key_4: 'Eunuch interference and secret police rule (Jinyiwei, Eastern Depot)', overview_key_5: 'Early focus on agriculture, late-stage sprouting of capitalism',
        overview_img_caption: 'The ruins of the Ming Palace in Nanjing, witnessing the ambition and spirit of the founding of the Great Ming Dynasty.',
        timeline_title: 'Rise and Fall of the Ming Dynasty',
        timeline_1_title: '1368 CE: Hongwu Founding', timeline_1_desc: 'Zhu Yuanzhang proclaimed himself emperor in Yingtian (Nanjing), founding the Ming Dynasty with the era name Hongwu. He launched a northern expedition to expel the Yuan emperor, ending Mongol rule in the Central Plains.',
        timeline_2_title: '1405 CE: Zheng He\'s First Voyage', timeline_2_desc: 'Emperor Yongle dispatched Zheng He with a massive fleet on the first of seven voyages to the "Western Oceans," showcasing Ming power and developing the tribute trade system over two decades.',
        timeline_3_title: '1449 CE: Tumu Crisis', timeline_3_desc: 'Emperor Yingzong was defeated and captured by the Oirat Mongols at the Tumu Fortress. This event is considered a turning point from the Ming\'s peak to its decline.',
        timeline_4_title: '1557 CE: Portuguese Lease of Macau', timeline_4_desc: 'The Portuguese began to reside in Macau, initially under the pretext of drying goods, marking the formal entry and long-term settlement of a Western power in China.',
        timeline_5_title: '1616 CE: Rise of the Later Jin', timeline_5_desc: 'Nurhaci united the Jurchen tribes and established the Later Jin (predecessor of the Qing), posing a severe threat to the Ming\'s Liaodong defensive line.',
        timeline_6_title: '1644 CE: Jiashen Incident', timeline_6_desc: 'Peasant rebel leader Li Zicheng captured Beijing. The Chongzhen Emperor hanged himself on Meishan (Coal Hill), ending the Ming Dynasty. The Qing army then entered the pass, beginning their rule.',
        territory_title: 'Territory & Geography',
        territory_map_caption: 'Map of the Ming Dynasty during the Yongle era. Click the <i class="fas fa-star text-yellow-500"></i> icons for more info.',
        territory_p1: 'The Ming Dynasty restored Han rule over its traditional territories. It extended to the Outer Khingan Mountains in the northeast, controlled the Gobi Desert to the north, reached Hami in the northwest, and the Yunnan-Guizhou Plateau in the southwest. The famous Great Wall was built to defend against northern Mongols.',
        territory_stats_title: 'Territorial Statistics',
        territory_stats_1a: 'Yongle Peak Area', territory_stats_1b: '≈6.5 million km²',
        territory_stats_2a: 'Late Ming Control', territory_stats_2b: '≈3.5 million km²',
        territory_stats_3a: 'Peak Population', territory_stats_3b: '≈150 million (1600 CE)',
        territory_stats_4a: 'Main Capitals', territory_stats_4b: 'Nanjing (Early) / Beijing (Yongle onward)',
        map_nanjing_title: 'Nanjing (Yingtian)', map_nanjing_desc: 'The founding capital of the Ming, its political and economic center. Zhu Yuanzhang established the early Ming system here. The Ming Xiaoling Mausoleum and the Ming Palace are its major relics.',
        map_beijing_title: 'Beijing (Shuntian)', map_beijing_desc: 'The capital was moved here during the Yongle reign, known as "the Son of Heaven guards the nation\'s gate." Grand structures like the Forbidden City and the Temple of Heaven were built, making it the imperial capital for the next 500 years.',
        map_yunnan_title: 'Yunnan', map_yunnan_desc: 'Through military conquest in the early Ming, Yunnan was fully incorporated into the empire and established as a province, a key achievement in consolidating the southwestern frontier.',
        map_macau_title: 'Macau', map_macau_desc: 'After the mid-Ming, the Portuguese leased this area as a trading post, which became an important window for exchange between the Ming and the Western world.',
        emperors_title: 'Major Emperors',
        emperor_1_name: 'Emperor Taizu (Zhu Yuanzhang)', emperor_1_reign: 'Reign: 1368-1398', emperor_1_feat1: 'Rose from poverty to found the dynasty', emperor_1_feat2: 'Abolished chancellorship, centralized power', emperor_1_feat3: 'Used harsh laws to consolidate rule',
        emperor_2_name: 'Emperor Chengzu (Zhu Di)', emperor_2_reign: 'Reign: 1402-1424', emperor_2_feat1: 'Seized throne, created Yongle prosperity', emperor_2_feat2: 'Sent Zheng He on voyages, compiled Yongle Encyclopedia', emperor_2_feat3: 'Moved capital to Beijing, led campaigns against Mongols',
        emperor_3_name: 'Emperor Shizong (Jiajing)', emperor_3_reign: 'Reign: 1521-1567', emperor_3_feat1: 'Strengthened imperial power via the "Great Rites Controversy"', emperor_3_feat2: 'Neglected court affairs for decades, obsessed with Taoism', emperor_3_feat3: 'Faced rampant piracy and border pressure',
        emperor_4_name: 'Emperor Sizong (Chongzhen)', emperor_4_reign: 'Reign: 1627-1644', emperor_4_feat1: 'Diligent but suspicious and indecisive', emperor_4_feat2: 'Reign plagued by disasters and rebellions', emperor_4_feat3: 'Committed suicide as the dynasty fell',
        gov_title: 'Government & Administration',
        gov_box1_title: 'Six Ministries System', gov_box1_desc: 'Emperor Taizu abolished the chancellorship, concentrating all power in the emperor. The six ministries (Personnel, Revenue, Rites, War, Justice, Works) reported directly to him, marking the peak of autocratic rule.',
        gov_box2_title: 'Jinyiwei & Depot-Guard Secret Police', gov_box2_desc: 'Secret police agencies like the Jinyiwei (Embroidered Uniform Guard), Eastern Depot, and Western Depot were established. Controlled by the emperor and eunuchs, they conducted surveillance, arrests, and trials, serving as tools of imperial terror.',
        gov_box3_title: 'Nine Garrisons & Weisuo System', gov_box3_desc: 'To defend against the Mongols, nine heavily fortified military garrisons were established along the Great Wall. The Weisuo system, where soldiers farmed for self-sufficiency, was implemented but later decayed, leading to low morale and combat effectiveness.',
        gov_chart_caption: 'Diagram of the late Ming power structure. While the civil bureaucracy (red) was the main administration, the eunuch cliques (gold) and Jinyiwei (gray), as extensions of imperial power, had a huge impact on politics.',
        culture_title: 'Culture & Art',
        culture_intro: 'Against the backdrop of a growing urban class, Ming culture became more secular and diverse. Vernacular literature like novels and opera flourished, while crafts and arts were known for their exquisite technique and ornate style.',
        culture_card1_title: 'Novels & Encyclopedias', culture_card1_desc: 'Full-length novels thrived, with the "Four Great Classical Novels"—Romance of the Three Kingdoms, Water Margin, Journey to the West, and The Plum in the Golden Vase—taking shape. The officially compiled Yongle Encyclopedia was a monumental work.',
        culture_card2_title: 'Blue-and-White Porcelain & Opera', culture_card2_desc: 'Jingdezhen became the world\'s porcelain capital, famous for its blue-and-white and doucai wares. In drama, Kunqu opera, originating from Kunshan, became the "ancestor of a hundred plays," with profound influence.',
        culture_card2_quote: '"So it was that the purples and reds bloomed in splendour, all now abandoned to broken wells and crumbling walls." <br>— Tang Xianzu, The Peony Pavilion',
        exchange_title: 'International Exchange',
        exchange_intro: 'The early Ming adopted an active foreign policy, exemplified by Zheng He\'s voyages, which established a vast tribute system. The mid-to-late period shifted to maritime bans, but smuggling and cultural exchange with the West never ceased.',
        exchange_box1_title: 'Zheng He\'s Seven Voyages', exchange_box1_desc: 'From 1405 to 1433, Zheng He led seven expeditions with his treasure fleet, visiting Southeast Asia, the Indian Ocean, and reaching as far as the East African coast and the Red Sea, the largest-scale naval expeditions of ancient China.',
        exchange_box2_title: 'Eastward Spread of Western Learning', exchange_box2_desc: 'In the late Ming, Jesuit missionaries like Matteo Ricci came to China, not only spreading Catholicism but also bringing Western knowledge of astronomy, mathematics, and geography, opening a new chapter in Sino-Western cultural exchange.',
        exchange_img_caption: 'Map of Zheng He\'s seven voyages, a feat in the history of world navigation.',
        scholars_title: 'Scholars & Technology',
        scholars_intro: 'In the mid-to-late Ming, amidst a trend of intellectual liberation, a group of scholars emerged who focused on practical studies. They compiled monumental works of science and technology, representing the peak and summary of traditional Chinese technological development.',
        scholar_1_name: 'Xu Guangqi', scholar_1_desc: 'A late-Ming scientist and statesman. He co-translated Euclid\'s "Elements" with Matteo Ricci, introducing Western science. His "Complete Treatise on Agriculture" is a definitive work on ancient Chinese agricultural science.',
        scholar_2_name: 'Li Shizhen', scholar_2_desc: 'A pharmacologist and physician. He spent nearly thirty years compiling the "Compendium of Materia Medica," a monumental work listing nearly 2,000 drugs and over 10,000 prescriptions, hailed as the "Great Pharmacopoeia of the East."',
        scholar_3_name: 'Song Yingxing', scholar_3_desc: 'A Ming scientist. His work "Tiangong Kaiwu" (The Exploitation of the Works of Nature) is the world\'s first comprehensive work on agricultural and industrial production, acclaimed as "China\'s 17th-century encyclopedia of technology."',
        decline_title: 'Decline and Fall of the Ming',
        decline_intro: 'The fall of the Ming was the result of a combination of political corruption, natural disasters, internal strife, and external threats. From the neglect of the Wanli era to the eunuch dictatorship of the Tianqi period, the state machinery finally collapsed under Chongzhen.',
        decline_img_caption: 'A painting depicting Li Zicheng\'s peasant army besieging Beijing, reflecting the turmoil of the late Ming.',
        decline_box1_title: 'Factionalism & Eunuch Dictatorship', decline_box1_desc: 'In the late Ming, struggles between the Donglin Party and the eunuch faction consumed national strength. During the Tianqi reign, the powerful eunuch Wei Zhongxian usurped state power, persecuting loyal officials and leading to extreme political darkness.',
        decline_box2_title: 'Disasters, Uprisings & Threats', decline_box2_desc: 'The late Ming coincided with the Little Ice Age, leading to frequent natural disasters and widespread famine. Heavy taxes sparked large-scale peasant uprisings led by Li Zicheng and Zhang Xianzhong. Meanwhile, the Later Jin (Qing) encroached on Ming territory.',
        decline_box3_title: 'Chongzhen\'s Suicide', decline_box3_desc: 'In 1644, Li Zicheng captured Beijing. The desperate Chongzhen Emperor hanged himself on Coal Hill (now Jingshan Park) behind the Forbidden City, marking the official end of the Ming Dynasty.',
        legacy_title: 'Historical Legacy',
        legacy_intro: 'The Ming Dynasty was not only a crucial turning point in Chinese history, but its tangible and intangible cultural heritage continues to profoundly influence China and the world. From grand architecture to exquisite art, it is a treasure of Chinese civilization.',
        legacy_box1_title: 'Architectural Heritage', legacy_box1_desc: 'The Forbidden City in Beijing and the Ming Tombs are paragons of Ming imperial architecture, both listed as UNESCO World Heritage sites. The Ming Great Wall is the most magnificent military defense project in human history.',
        legacy_box2_title: 'Institutional & Territorial Legacy', legacy_box2_desc: 'The provincial system and centralized power model established by the Ming were inherited by the Qing. The territory it established, especially its administration of the southwest and northeast, formed the basis of modern China\'s map.',
        legacy_box3_title: 'Crafts & Cultural Influence', legacy_box3_desc: 'Jingdezhen\'s porcelain technology influenced the entire world. Ming-style furniture, with its simple and elegant design, became the pinnacle of classical furniture. Literary works like the Four Great Classical Novels remain cultural classics in the Chinese-speaking world.',
        legacy_quote: '"The Son of Heaven guards the nation\'s gate; the monarch dies with his state."',
        legacy_quote_author: '— A later appraisal of the Ming capital in Beijing and Chongzhen\'s fate',
        yongle_video_title: 'Yongle Encyclopedia Showcase',
        yongle_video_desc: "<strong>About the Yongle Encyclopedia</strong><br><br>The 'Yongle Dadian' is an encyclopedia commissioned by the Yongle Emperor of the Ming Dynasty, and it stands as the largest encyclopedia in ancient China. The complete work consisted of 22,937 manuscript rolls, bound in 11,095 volumes, containing approximately 370 million Chinese characters. It compiled seven to eight thousand types of books and documents from before the Ming era.<br><br>Thousands of scholars from across the country were mobilized for its compilation, which took five years to complete. Its content covers all fields of knowledge, including classics, history, philosophy, literature, astronomy, geography, medicine, divination, and various arts and skills. It not only preserved a vast number of precious pre-Yuan documents but also reflected the cultural confidence and national strength of the early Ming. Unfortunately, the original manuscript is lost, and most of the duplicate was scattered and destroyed during the turmoil of the late Ming and late Qing. Today, only about 400 volumes survive, scattered around the world, as priceless treasures of Chinese culture.",
        chart_gov_title: 'Late Ming Power Structure (Schematic)',
        chart_gov_label_civil: 'Civil Bureaucracy', chart_gov_label_eunuch: 'Eunuch Faction', chart_gov_label_secret: 'Jinyiwei',
        chart_gov_yaxis: 'Relative Influence Index',
        chart_rel_title: 'Zheng He\'s Voyage Network',
        chart_rel_label: 'Interaction Intensity', chart_rel_cats: ['Korea/Japan', 'SE Asia', 'India', 'Persia/Arabia', 'East Africa'],
      }
    };

    // --- 核心腳本 (此部分無需修改) ---
    document.addEventListener('DOMContentLoaded', function() {
        
        const AUTOPLAY_INTERVAL = 8000;
        
        const playlist = [
            'https://ping763573.github.io/big-adventure/07.mp3',
            'https://ping763573.github.io/big-adventure/08.mp3'
        ];
        let currentTrackIndex = 0;

        let currentLang = 'zh-TW';
        let isAutoplaying = false;
        let autoplayTimeoutId;
        let currentSectionIndex = 0;
        let currentlySpeakingSection = null;
        let isManuallyStopped = false; 
        let activeLockSection = null;

        const sections = Array.from(document.querySelectorAll('main > section'));
        const langToggleBtn = document.getElementById('lang-toggle');
        const autoplayToggleBtn = document.getElementById('autoplay-toggle');
        const fullscreenToggleBtn = document.getElementById('fullscreen-toggle');
        const musicToggleBtn = document.getElementById('music-toggle');
        const toTopBtn = document.getElementById('to-top-btn');
        const bgMusic = document.getElementById('bg-music');
        const navbar = document.querySelector('.navbar');
        
        bgMusic.src = playlist[currentTrackIndex]; 
        bgMusic.addEventListener('ended', () => {
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            bgMusic.src = playlist[currentTrackIndex];
            bgMusic.play();
        });

        function lockScreenToSection(section) {
            document.body.classList.add('tts-active');
            activeLockSection = section;
        }
        function unlockScreen() {
            document.body.classList.remove('tts-active');
            activeLockSection = null;
        }
        function setTtsButtonState(button, isPlaying) {
            const playKey = 'tts_play_btn';
            const stopKey = 'tts_stop_btn';
            if (isPlaying) {
                button.innerHTML = translations[currentLang][stopKey] || '⏹️ Stop Reading';
                button.classList.add('is-playing');
            } else {
                button.innerHTML = translations[currentLang][playKey] || '🔊 Read Aloud';
                button.classList.remove('is-playing');
            }
        }
        function updateLanguage() {
            document.documentElement.lang = currentLang;
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.dataset.langKey;
                if (translations[currentLang][key]) {
                    if (el.classList.contains('tts-btn') && el.classList.contains('is-playing')) {
                         el.innerHTML = translations[currentLang]['tts_stop_btn'];
                    } else {
                         el.innerHTML = translations[currentLang][key];
                    }
                }
            });
            initializeAllCharts(currentLang);
        }
        langToggleBtn.addEventListener('click', () => {
            currentLang = currentLang === 'zh-TW' ? 'en' : 'zh-TW';
            updateLanguage();
        });
        function getCleanTextForTTS(section) {
            const contentContainer = section.querySelector('.content-container');
            if (!contentContainer) return "";
            const clone = contentContainer.cloneNode(true);
            clone.querySelectorAll('.tts-btn, .section-title, .image-container-styled, canvas, .scholar-img, iframe, .hotspot, .info-box').forEach(el => el.remove());
            const title = section.querySelector('.section-title')?.innerText || '';
            const body = clone.innerText.trim().replace(/\s+/g, ' ');
            return `${title}. ${body}`;
        }
        function stopAutoscroll() {
            isAutoplaying = false;
            document.body.classList.remove('autoplay-active'); 
            autoplayToggleBtn.innerHTML = '<i class="fas fa-play"></i>';
            clearTimeout(autoplayTimeoutId);
        }
        function stopSpeech() {
            if (!speechSynthesis.speaking) return;
            isManuallyStopped = true; 
            speechSynthesis.cancel(); 
        }
        function speakSection(section, onEndCallback) {
            const textToSpeak = getCleanTextForTTS(section);
            if (!textToSpeak) { if (onEndCallback) onEndCallback(); return; }
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = currentLang === 'en' ? 'en-US' : 'zh-TW';
            const ttsBtn = section.querySelector('.tts-btn');
            utterance.onstart = () => {
                currentlySpeakingSection = section;
                if (ttsBtn) setTtsButtonState(ttsBtn, true);
                lockScreenToSection(section);
            };
            utterance.onend = () => {
                const wasManuallyStopped = isManuallyStopped;
                if (currentlySpeakingSection === section) { if (ttsBtn) setTtsButtonState(ttsBtn, false); currentlySpeakingSection = null; }
                unlockScreen();
                if (onEndCallback && !wasManuallyStopped) onEndCallback();
            };
            utterance.onerror = (e) => {
                console.error("Speech synthesis error:", e);
                if (currentlySpeakingSection === section) { if (ttsBtn) setTtsButtonState(ttsBtn, false); currentlySpeakingSection = null; }
                unlockScreen();
                if (onEndCallback) onEndCallback();
            };
            isManuallyStopped = false; 
            speechSynthesis.speak(utterance);
        }
        function playAndAdvance() {
            if (!isAutoplaying) return;
            clearTimeout(autoplayTimeoutId);
            const section = sections[currentSectionIndex];
            if (!section) { stopAutoscroll(); return; }
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            autoplayTimeoutId = setTimeout(() => {
                if (isAutoplaying) {
                    // This logic skips the last section (the video) by looping back when on the second to last section.
                    currentSectionIndex = (currentSectionIndex >= sections.length - 2) ? 0 : currentSectionIndex + 1;
                    playAndAdvance();
                }
            }, AUTOPLAY_INTERVAL);
        }
        function startAutoscroll() {
            if (isAutoplaying) return;
            if (speechSynthesis.speaking) { speechSynthesis.cancel(); }
            isAutoplaying = true;
            document.body.classList.add('autoplay-active'); 
            autoplayToggleBtn.innerHTML = '<i class="fas fa-pause"></i>';
            
            let mostVisibleSectionIndex = 0; let maxVisibility = 0;
            sections.forEach((section, index) => {
                const rect = section.getBoundingClientRect();
                const vh = window.innerHeight || document.documentElement.clientHeight;
                const visibleHeight = Math.max(0, Math.min(rect.bottom, vh) - Math.max(rect.top, 0));
                if (visibleHeight > maxVisibility) { maxVisibility = visibleHeight; mostVisibleSectionIndex = index; }
            });

            if (sections[mostVisibleSectionIndex] && sections[mostVisibleSectionIndex].id === 'yongle-video') {
                currentSectionIndex = 0;
            } else {
                currentSectionIndex = mostVisibleSectionIndex;
            }
            playAndAdvance();
        }
        autoplayToggleBtn.addEventListener('click', () => { isAutoplaying ? stopAutoscroll() : startAutoscroll(); });

        function updateFullscreenIcon() {
            fullscreenToggleBtn.innerHTML = !document.fullscreenElement ? '<i class="fas fa-expand"></i>' : '<i class="fas fa-compress"></i>';
        }
        fullscreenToggleBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => alert(`無法進入全螢幕模式: ${err.message}`));
            } else { if (document.exitFullscreen) document.exitFullscreen(); }
        });
        document.addEventListener('fullscreenchange', updateFullscreenIcon);
        musicToggleBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("音樂自動播放被瀏覽器阻止。"));
                musicToggleBtn.innerHTML = '<i class="fas fa-music"></i>';
            } else { bgMusic.pause(); musicToggleBtn.innerHTML = '<i class="fas fa-volume-mute"></i>'; }
        });
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
        }, { threshold: 0.15 });
        document.querySelectorAll('.scroll-reveal').forEach(el => observer.observe(el));
        function getCurrentSectionId() {
            let current = '';
            for (const section of sections) {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= sectionTop - 200) current = section.getAttribute('id');
            }
            return current;
        }
        window.addEventListener('scroll', () => {
            if(document.body.classList.contains('tts-active')) return;
            if (window.pageYOffset > 300) toTopBtn.style.display = 'flex'; else toTopBtn.style.display = 'none';
            if (window.scrollY > 50) navbar.classList.add('scrolled'); else navbar.classList.remove('scrolled');
            
            const current = getCurrentSectionId();
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').includes(current)) link.classList.add('active');
            });
        });
        toTopBtn.addEventListener('click', () => { stopAutoscroll(); stopSpeech(); window.scrollTo({ top: 0, behavior: 'smooth' }); });
        document.querySelectorAll('.nav-links a').forEach(link => { link.addEventListener('click', () => { stopAutoscroll(); stopSpeech(); }); });
        
        document.querySelectorAll('.hotspot').forEach(hotspot => {
          hotspot.addEventListener('click', (e) => {
            e.stopPropagation();
            const targetId = hotspot.dataset.target;
            const infoBox = document.getElementById(targetId);
            const isVisible = infoBox.style.display === 'block';
            document.querySelectorAll('.info-box').forEach(box => box.style.display = 'none');
            if (infoBox && !isVisible) infoBox.style.display = 'block';
          });
        });
        document.addEventListener('click', () => { document.querySelectorAll('.info-box').forEach(box => box.style.display = 'none'); });
        
        document.querySelectorAll('.tts-btn').forEach(button => {
            button.addEventListener('click', () => {
                if (isAutoplaying) return;
                const section = button.closest('.slide-section');
                if (!section) return;
                const wasSpeakingThisSection = (currentlySpeakingSection === section && speechSynthesis.speaking);
                stopSpeech();
                if (!wasSpeakingThisSection) { speakSection(section, null); }
            });
        });

        let charts = {};
        function initializeAllCharts(lang) {
            const langData = translations[lang];
            const titleFont = { family: "'Noto Serif TC', serif", size: 20, weight: 'bold' };
            const bodyFont = { family: "'Noto Serif TC', serif", size: 16 };
            const primaryColor = '#8C1B17';
            const accentColor = '#C5A56A';
            const secondaryColor = '#6c757d';
            const darkText = '#3D3D3D';

            Object.keys(charts).forEach(id => { if(charts[id]) charts[id].destroy(); });

            Chart.defaults.color = darkText; 
            Chart.defaults.font.family = "'Noto Serif TC', serif";

            if (document.getElementById('governmentChart')) {
              const ctx = document.getElementById('governmentChart').getContext('2d');
              charts.government = new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: lang === 'zh-TW' ? ['洪武', '永樂', '嘉靖', '萬曆', '天啟'] : ['Hongwu', 'Yongle', 'Jiajing', 'Wanli', 'Tianqi'],
                  datasets: [
                    { label: langData.chart_gov_label_civil, data: [80, 75, 60, 50, 40], backgroundColor: 'rgba(140, 27, 23, 0.7)', borderColor: primaryColor, borderWidth: 2 }, 
                    { label: langData.chart_gov_label_eunuch, data: [5, 20, 40, 50, 60], backgroundColor: 'rgba(197, 165, 106, 0.7)', borderColor: accentColor, borderWidth: 2 },
                    { label: langData.chart_gov_label_secret, data: [15, 25, 20, 30, 45], backgroundColor: 'rgba(108, 117, 125, 0.7)', borderColor: secondaryColor, borderWidth: 2 }
                  ]
                },
                options: { 
                  responsive: true, maintainAspectRatio: false,
                  plugins: { title: { display: true, text: langData.chart_gov_title, font: titleFont, color: primaryColor }, legend: { position: 'bottom', labels: { font: bodyFont } } }, 
                  scales: { y: { beginAtZero: true, stacked: true, title: { display: true, text: langData.chart_gov_yaxis, font: bodyFont } }, x: { stacked: true } }
                }
              });
            }
        }

        updateLanguage();
        
        document.addEventListener('click', function initMusic() {
          if(bgMusic.paused){
            bgMusic.play().catch(e => console.log("音樂自動播放被瀏覽器阻止。"));
            musicToggleBtn.innerHTML = '<i class="fas fa-music"></i>';
          }
          document.removeEventListener('click', initMusic);
        });
    });
    </script>
</body>
</html>