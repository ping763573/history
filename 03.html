<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水墨江山：大宋王朝</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 移除了 YouTube IFrame Player API 的載入 -->
    <style>
      /* --- 字體導入 --- */
      @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+TC:wght@400;700;900&family=ZCOOL+XiaoWei&family=Zhi+Mang+Xing&display=swap');
      
      /* --- 變數定義 (宋代風格) --- */
      :root {
        --bg-color: #F8F6F2; /* 宣紙米白 */
        --primary-color: #4A6C5B; /* 主色 - 淡雅青綠 */
        --accent-color: #A99A86;  /* 強調色 - 水墨灰/米色 */
        --accent-light: #E0D8CC;  /* 強調淺色 - 淡米 */
        --text-color: #3D3D3D;    /* 內文顏色 - 深灰黑 */
        --title-font: 'Ma Shan Zheng', 'Noto Serif TC', serif;
        --body-font: 'Noto Serif TC', serif;
        --cursive-font: 'Zhi Mang Xing', cursive;
        --elegant-font: 'ZCOOL+XiaoWei', serif;
      }

      html { scroll-behavior: smooth; }
      body {
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: var(--body-font);
        font-size: 18px;
        background-image: url('https://www.transparenttextures.com/patterns/paper.png'); /* 書卷紋理 */
        overflow-x: hidden;
      }
      
      /* --- 水墨卷轴效果 --- */
      .silk-scroll-effect {
        position: relative;
      }
      .silk-scroll-effect::before,
      .silk-scroll-effect::after {
        content: '';
        position: absolute;
        width: 60px;
        height: 100%;
        top: 0;
        z-index: 5;
        background: linear-gradient(90deg, rgba(248, 246, 242, 0.8), transparent);
        pointer-events: none;
      }
      .silk-scroll-effect::before {
        left: 0;
      }
      .silk-scroll-effect::after {
        right: 0;
        transform: rotate(180deg);
      }
      
      /* --- 通用區塊設定 --- */
      .slide-section {
        width: 100%;
        min-height: 100vh;
        padding: 180px 40px 80px; 
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        max-width: 1600px;
        margin: 0 auto;
        border-bottom: 1px solid rgba(74, 108, 91, 0.1);
      }
      
      /* --- 内容承载层 --- */
      .content-container {
        background: rgba(248, 246, 242, 0.92);
        border-radius: 12px;
        padding: 40px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(169, 154, 134, 0.3);
        position: relative;
        z-index: 10;
        width: 90%;
        max-width: 1400px;
        margin: 0 auto;
      }
      .content-container::before {
        content: '';
        position: absolute;
        top: 10px;
        left: 10px;
        right: 10px;
        bottom: 10px;
        border: 2px solid rgba(169, 154, 134, 0.15);
        border-radius: 8px;
        pointer-events: none;
        z-index: -1;
      }

      /* --- 標題美化 --- */
      .section-title {
        font-family: var(--title-font);
        font-size: 4.5rem;
        color: var(--primary-color);
        margin-bottom: 50px;
        text-align: center;
        line-height: 1.2;
        position: relative;
        padding-bottom: 30px;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.1);
        letter-spacing: 2px;
      }
      /* 标题装饰线 (水墨筆觸) */
      .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 10px;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="10" viewBox="0 0 200 10"><path d="M0,5 C40,2 80,8 120,5 S160,2 200,6" fill="none" stroke="%23A99A86" stroke-width="3" stroke-linecap="round"/></svg>');
        background-repeat: no-repeat;
        background-position: center;
      }

      /* --- 導覽列 --- */
      .navbar {
        position: fixed; top: 0; left: 0; width: 100%;
        background-color: rgba(74, 108, 91, 0.95); /* 青綠色 */
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        z-index: 1000; padding: 15px 20px;
        transition: all 0.4s ease;
      }
      .navbar.scrolled {
        padding: 10px 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      }
      .nav-links { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px 25px; }
      .nav-links a {
        color: var(--bg-color); 
        font-family: var(--elegant-font);
        font-size: 18px; 
        padding: 10px 20px; 
        border-radius: 30px;
        transition: all 0.4s ease;
        position: relative;
        letter-spacing: 1px;
      }
      .nav-links a:hover, .nav-links a.active { 
        background: linear-gradient(135deg, var(--accent-color), #8a7c6a);
        color: var(--primary-color);
        transform: translateY(-4px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      }
      .nav-links a::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 30px;
        background: linear-gradient(135deg, transparent, rgba(169, 154, 134, 0.3));
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .nav-links a:hover::before {
        opacity: 1;
      }

      /* --- 控制面板 --- */
      .control-panel {
        position: fixed; top: 120px; right: 30px;
        display: flex; flex-direction: column; gap: 15px; z-index: 999;
      }
      .control-btn {
        width: 55px; height: 55px;
        background: linear-gradient(135deg, var(--primary-color), #3a5647);
        color: var(--accent-color);
        border: 2px solid var(--accent-color);
        border-radius: 50%;
        display: flex; justify-content: center; align-items: center;
        cursor: pointer; font-size: 22px;
        transition: all 0.4s ease;
        box-shadow: 0 5px 15px rgba(0,0,0,0.25);
      }
      .control-btn:hover {
        background: linear-gradient(135deg, var(--accent-color), #8a7c6a);
        color: var(--primary-color);
        transform: scale(1.15) rotate(12deg);
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      }
      #to-top-btn { display: none; }
      
      /* --- 語音導讀按鈕 Playing 狀態 --- */
      .tts-btn.is-playing {
        background-color: var(--accent-color);
        color: var(--primary-color);
      }
      .tts-btn.is-playing:hover {
        background-color: #8a7c6a;
      }
      
      /* --- 自動播放時隱藏語音按鈕 --- */
      .autoplay-active .tts-btn {
        display: none;
      }
      
      /* --- 語音播放時鎖定畫面樣式 --- */
      body.tts-active .nav-links a,
      body.tts-active #to-top-btn {
          pointer-events: none;
          opacity: 0.5;
          cursor: not-allowed;
          transition: opacity 0.3s ease;
      }

      /* --- 捲動動畫 --- */
      .scroll-reveal { 
        opacity: 0; 
        transform: translateY(50px); 
        transition: opacity 1s ease-out, transform 1s ease-out; 
      }
      .scroll-reveal.visible { 
        opacity: 1; 
        transform: translateY(0); 
      }
      
      /* --- 時間軸視覺強化 --- */
      .visual-timeline { 
        position: relative; 
        width: 100%; 
        max-width: 900px; 
        margin: 50px auto;
        padding: 20px 0;
      }
      .visual-timeline::after {
        content: ''; 
        position: absolute; 
        width: 8px; 
        background: linear-gradient(to bottom, transparent, var(--accent-color), transparent);
        top: 0; 
        bottom: 0; 
        left: 50%; 
        margin-left: -4px; 
        z-index: 1;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(169, 154, 134, 0.5);
      }
      .timeline-container { 
        padding: 10px 40px; 
        position: relative; 
        background-color: inherit; 
        width: 50%; 
      }
      .timeline-container.left { left: 0; }
      .timeline-container.right { left: 50%; }
      .timeline-container::after {
        content: ''; 
        position: absolute; 
        width: 35px; 
        height: 35px; 
        right: -17px;
        background-color: var(--bg-color); 
        border: 4px solid var(--primary-color);
        top: 25px; 
        border-radius: 50%; 
        z-index: 2;
        transition: all 0.4s ease;
        box-shadow: 0 0 0 6px rgba(169, 154, 134, 0.4);
      }
      .timeline-container:hover::after { 
        transform: scale(1.4);
        background-color: var(--accent-color);
        box-shadow: 0 0 0 8px rgba(169, 154, 134, 0.6);
      }
      .timeline-container.right::after { left: -17px; }
      .timeline-content {
        padding: 30px 40px; 
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(224, 216, 204, 0.4)); 
        position: relative; 
        border-radius: 15px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        border: 1px solid rgba(74, 108, 91, 0.2);
        border-left: 10px solid var(--primary-color);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        backdrop-filter: blur(4px);
      }
      .timeline-content:hover {
        transform: translateY(-15px) rotate(1deg);
        box-shadow: 0 15px 35px rgba(0,0,0,0.3);
      }
      .timeline-content h3 { 
        font-size: 26px; 
        color: var(--primary-color); 
        font-family: var(--title-font); 
        margin-bottom: 15px;
        border-bottom: 2px solid var(--accent-light);
        padding-bottom: 10px;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      }
      .timeline-content p { 
        font-size: 18px; 
        line-height: 1.8; 
        font-family: var(--elegant-font);
      }

      /* --- 互動地圖 --- */
      .map-container-interactive { 
        position: relative; 
        width: 100%; 
        max-width: 800px; 
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        border: 3px solid var(--accent-light);
        transform: perspective(1000px) rotateX(5deg) rotateY(0deg);
        transition: transform 0.5s ease;
      }
      .map-container-interactive:hover {
        transform: perspective(1000px) rotateX(2deg) rotateY(2deg);
      }
      .hotspot {
        position: absolute; 
        width: 40px; 
        height: 40px;
        background: radial-gradient(circle, rgba(169, 154, 134, 0.9), rgba(138, 124, 106, 0.9)); 
        border: 3px solid white;
        border-radius: 50%; 
        cursor: pointer;
        transition: all 0.4s ease;
        display: flex; 
        justify-content: center; 
        align-items: center;
        box-shadow: 0 0 20px rgba(169, 154, 134, 0.8);
        animation: pulse 2s infinite;
        z-index: 10;
      }
      @keyframes pulse { 
        0% { transform: scale(1); box-shadow: 0 0 10px rgba(169, 154, 134, 0.5); } 
        50% { transform: scale(1.2); box-shadow: 0 0 30px rgba(169, 154, 134, 1); } 
        100% { transform: scale(1); box-shadow: 0 0 10px rgba(169, 154, 134, 0.5); } 
      }
      .hotspot:hover { 
        transform: scale(1.6); 
        background: radial-gradient(circle, var(--primary-color), #3a5647); 
        animation-play-state: paused; 
        z-index: 20;
      }
      .hotspot .fa-star { 
        color: white; 
        font-size: 18px; 
        transition: transform 0.3s ease;
      }
      .hotspot:hover .fa-star {
        transform: rotate(360deg);
      }
      .info-box {
        display: none; 
        position: absolute; 
        background: linear-gradient(135deg, rgba(20, 30, 20, 0.95), rgba(30, 45, 35, 0.95));
        color: var(--accent-light);
        padding: 25px; 
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.6); 
        z-index: 20;
        width: 300px; 
        border-left: 5px solid var(--accent-color);
        font-family: var(--elegant-font);
        backdrop-filter: blur(8px);
        animation: fadeIn 0.4s ease;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .info-box h3 { 
        font-family: var(--title-font); 
        font-size: 24px; 
        color: var(--accent-color); 
        margin-bottom: 15px;
        border-bottom: 1px solid rgba(169, 154, 134, 0.4);
        padding-bottom: 10px;
      }
      .info-box p {
        font-size: 17px;
        line-height: 1.7;
      }

      /* --- 卡片通用樣式 --- */
      .styled-card {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(224, 216, 204, 0.3));
        border: 1px solid rgba(169, 154, 134, 0.3);
        border-radius: 18px;
        padding: 30px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
        backdrop-filter: blur(4px);
      }
      .styled-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 6px;
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      }
      .styled-card:hover {
        transform: translateY(-20px) rotate(2deg);
        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      }
      
      /* --- 圖片容器 --- */
      .image-container-styled {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        border: 6px solid var(--accent-color);
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        transition: all 0.5s ease;
        transform: perspective(1000px) rotateX(5deg);
      }
      .image-container-styled:hover {
        box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        transform: perspective(1000px) rotateX(2deg);
      }
      .image-container-styled img {
        width: auto; 
        height: auto;
        max-width: 100%; 
        max-height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
      }
      .image-container-styled:hover img {
        transform: scale(1.1);
      }

      /* --- 首頁特殊樣式 --- */
      #title {
        background: linear-gradient(rgba(20, 30, 20, 0.45), rgba(20, 30, 20, 0.45));
        background-size: cover;
        color: var(--accent-color);
      }
      #title .border-pattern {
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 40px solid transparent;
        border-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80"><path d="M0,0 L80,0 L80,80 L0,80 Z" fill="none" stroke="%23A99A86" stroke-width="3"/><path d="M20,20 L60,20 L60,60 L20,60 Z" fill="none" stroke="%23A99A86" stroke-width="2" stroke-dasharray="8,8"/></svg>') 40 stretch;
        pointer-events: none; z-index: 10;
      }
      #title h1 {
        font-family: 'Ma Shan Zheng', cursive;
        font-size: 8rem;
        font-weight: 700;
        margin-bottom: 25px;
        color: #F8F4E0; /* 亮米色 */
        text-shadow: 5px 5px 15px rgba(0, 0, 0, 0.9);
        letter-spacing: 3px;
        line-height: 1.1;
      }
      #title h2 {
        font-family: var(--elegant-font);
        font-size: 3rem;
        font-weight: 400;
        margin-bottom: 50px;
        color: var(--accent-color);
        letter-spacing: 3px;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
      }
      .copyright-notice {
        position: absolute; bottom: 25px; left: 30px;
        transform: none; font-size: 16px;
        color: var(--accent-color);
        background-color: rgba(0, 0, 0, 0.5);
        padding: 10px 22px; 
        border-radius: 12px; 
        z-index: 30;
        font-family: var(--elegant-font);
        letter-spacing: 1px;
      }
      .title-content {
        position: relative;
        z-index: 20;
        text-align: center;
        padding: 60px;
        max-width: 1400px;
        margin: 0 auto;
      }
      .title-subtitle {
        font-size: 2rem;
        margin-top: 70px;
        font-family: var(--cursive-font);
        letter-spacing: 2px;
        text-shadow: 3px 3px 8px rgba(0,0,0,0.8);
        line-height: 1.7;
        max-width: 900px;
        margin: 70px auto 0;
      }

      /* --- Section Backgrounds & Readability --- */
      .slide-section {
        background-size: cover;
        background-position: center center;
        background-attachment: fixed;
      }
      #overview { background: linear-gradient(rgba(20, 30, 20, 0.25), rgba(20, 30, 20, 0.25)), url('https://img.soundofhope.org/2017/04/qim.jpg') center center/cover; }
      #timeline { background: linear-gradient(rgba(20, 30, 20, 0.2), rgba(20, 30, 20, 0.2)), url('https://pic30.photophoto.cn/20140104/0020032932872867_b.jpg') center center/cover; }
      #territory { background: linear-gradient(rgba(20, 30, 20, 0.3), rgba(20, 30, 20, 0.3)), url('https://q7.itc.cn/images01/20240517/7a9327ca798345288ec390406ad40012.jpeg') center center/cover; }
      #emperors { background: linear-gradient(rgba(20, 30, 20, 0.2), rgba(20, 30, 20, 0.2)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Qingming_shanghe_tu_gate_tower.jpg/250px-Qingming_shanghe_tu_gate_tower.jpg') center center/cover; }
      #government { background: linear-gradient(rgba(20, 30, 20, 0.3), rgba(20, 30, 20, 0.3)), url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZtDGHhJvHn75B9-AjBDOWAdaaTAPVf_Tngg&s') center center/cover; }
      #culture { background: linear-gradient(rgba(20, 30, 20, 0.25), rgba(20, 30, 20, 0.25)), url('https://bpic.588ku.com/element_pic/24/12/14/1e3537b7bea01fa85a1ff176a6055133.jpg!/fw/350/quality/99/unsharp/true/compress/true') center center/cover; }
      #exchange { background: linear-gradient(rgba(20, 30, 20, 0.2), rgba(20, 30, 20, 0.2)), url('https://pic.huitu.com/pic/20230103/1417944_20230103224507037228_0.jpg') center center/cover; }
      #scholars { background: linear-gradient(rgba(20, 30, 20, 0.25), rgba(20, 30, 20, 0.25)), url('https://i.epochtimes.com/assets/uploads/2022/04/id13692455-b121f75bd7966a286c3f553432c0e15d-450x196.jpg') center center/cover; }
      #decline { background: linear-gradient(rgba(20, 5, 0, 0.2), rgba(20, 5, 0, 0.2)), url('https://lh4.googleusercontent.com/proxy/Rz4xkPqc-onka_zJRP3_CT-Di_urRiK8l_ijhoiJEEf_jm_RL87gTh3pwpuzHFNueQy7LP1z1bVfcTbNhdvsF1rU1-TLpt26ok4mDEQ') center center/cover; }
      #legacy { background: linear-gradient(rgba(20, 30, 20, 0.2), rgba(20, 30, 20, 0.2)), url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcREb7EYlEQgy1ng9o6lPHROd25Sq_lzMwzKWg&s') center center/cover; }
      #qingming-video { background: linear-gradient(rgba(20, 30, 20, 0.25), rgba(20, 30, 20, 0.25)), url('https://south.npm.gov.tw/FileDownLoad/Selections/OriginalImage/202001061601029635.jpg') center center/cover; }
      
      /* 保護卡片內的文字顏色，使其保持深色 */
      .timeline-content, .styled-card, .info-card, .quote-block, .h-96, .h-80 {
          text-shadow: none;
      }
      .timeline-content *, .styled-card *, .info-card *, .quote-block *, .h-96 *, .h-80 * {
          text-shadow: none;
      }
      .timeline-content, .styled-card {
        color: var(--text-color);
      }
      .timeline-content h3, .styled-card .text-green-800, .info-card .text-green-800 { 
        color: var(--primary-color); 
      }
      .styled-card .text-gray-600 { color: #4b5563; }
      .styled-card .text-gray-700 { color: #374151; }
      
      /* 針對特定元素的精細調整 */
      .info-card {
        background: linear-gradient(145deg, rgba(248, 246, 242, 0.95), rgba(224, 216, 204, 0.4)) !important;
        backdrop-filter: blur(5px);
        color: var(--text-color);
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        padding: 30px;
      }
      .info-card li {
        color: var(--text-color);
      }
      .info-card .text-yellow-600 {
        color: #8a7c6a; /* 調整為主題色 */
      }
      .info-card .text-green-800 {
        color: var(--primary-color);
      }
      
      /* 確保圖片說明等小字使用深色 */
      #overview .text-sm, #territory .text-sm, #emperors .text-sm, #exchange .text-sm, #decline .text-sm {
        color: var(--text-color);
        opacity: 0.85;
      }
      
      /* 引言區塊文字顏色 (此處維持淺色，因為背景是暗色) */
      .quote-block {
        background: linear-gradient(135deg, rgba(20, 30, 20, 0.7), rgba(30, 45, 35, 0.7));
        border-color: var(--accent-color);
        border-left: 10px solid var(--accent-color);
        padding: 35px;
        border-radius: 15px;
        max-width: 900px;
        margin: 50px auto;
        backdrop-filter: blur(5px);
      }
      .quote-block p {
        color: var(--accent-light);
        text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
      }
      
      /* 新增元素：宋代風格装饰 (梅花) */
      .tang-decoration {
        position: absolute;
        width: 150px;
        height: 150px;
        opacity: 0.15;
        z-index: 1;
        background-size: contain;
        background-repeat: no-repeat;
      }
      .decoration-1 {
        top: 30px; left: 30px;
        background-image: url('https://png.pngtree.com/png-vector/20230303/ourmid/pngtree-chinese-style-ink-plum-blossom-png-image_6628945.png');
      }
      .decoration-2 {
        bottom: 30px; right: 30px; transform: rotate(180deg);
        background-image: url('https://png.pngtree.com/png-vector/20230303/ourmid/pngtree-chinese-style-ink-plum-blossom-png-image_6628945.png');
      }
      .decoration-3 {
        top: 40%; right: 5%; width: 120px; height: 120px;
        background-image: url('https://png.pngtree.com/png-vector/20230303/ourmid/pngtree-chinese-style-ink-plum-blossom-png-image_6628945.png');
        opacity: 0.1; transform: rotate(25deg);
      }
      .decoration-4 {
        bottom: 30%; left: 5%; width: 100px; height: 100px;
        background-image: url('https://png.pngtree.com/png-vector/20230303/ourmid/pngtree-chinese-style-ink-plum-blossom-png-image_6628945.png');
        opacity: 0.1; transform: rotate(-15deg);
      }
      
      /* 士人卡片特殊样式 */
      .scholar-card {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(224, 216, 204, 0.3));
        border-radius: 20px;
        overflow: hidden;
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        position: relative;
        height: 100%;
      }
      .scholar-card:hover {
        transform: translateY(-15px) rotate(1.5deg);
        box-shadow: 0 20px 45px rgba(0,0,0,0.25);
      }
      .scholar-img {
        height: 280px;
        overflow: hidden;
        position: relative;
      }
      .scholar-img img {
        width: 100%; height: 100%;
        object-fit: cover; object-position: top;
        transition: transform 0.6s ease;
      }
      .scholar-card:hover .scholar-img img {
        transform: scale(1.15);
      }
      .scholar-content { padding: 25px; }
      .scholar-name {
        font-family: var(--title-font);
        font-size: 28px;
        color: var(--primary-color);
        margin-bottom: 10px;
        border-bottom: 2px solid var(--accent-light);
        padding-bottom: 8px;
      }
      .scholar-desc {
        font-family: var(--elegant-font);
        font-size: 17px;
        line-height: 1.8;
        color: var(--text-color);
      }
      
      /* 响应式调整 */
      @media (max-width: 1024px) {
        .section-title { font-size: 3.8rem; }
        .nav-links { gap: 8px 20px; }
        .nav-links a { padding: 8px 16px; font-size: 17px; }
      }
      
      @media (max-width: 768px) {
        .section-title { font-size: 3.2rem; padding: 0 20px 20px; }
        .slide-section { padding: 180px 25px 60px; }
        #title h1 { font-size: 6rem; }
        #title h2 { font-size: 2.5rem; }
        .title-subtitle { font-size: 1.8rem; }
        .content-container { padding: 30px; }
        .timeline-container { width: 100%; padding: 10px 30px 10px 60px; left: 0 !important; }
        .timeline-container::after { left: 25px !important; right: auto !important; }
        .visual-timeline::after { left: 30px; }
        .control-panel { top: auto; bottom: 20px; right: 15px; }
        .control-btn { width: 48px; height: 48px; font-size: 20px; }
      }
      
      @media (max-width: 480px) {
        .section-title { font-size: 2.8rem; }
        #title h1 { font-size: 4.5rem; }
        #title h2 { font-size: 2rem; }
        .title-subtitle { font-size: 1.5rem; margin-top: 50px; }
        .copyright-notice { font-size: 14px; left: 15px; bottom: 15px; }
        .nav-links a { padding: 7px 14px; font-size: 16px; }
        .content-container { padding: 20px; }
      }
    </style>
</head>
<body class="silk-scroll-effect">

    <!-- 背景音樂播放器 -->
    <audio id="bg-music" loop src="https://ping763573.github.io/big-adventure/09.mp3"></audio>

    <!-- 導覽列 -->
    <nav class="navbar">
      <div class="nav-links">
        <a href="#title" data-lang-key="nav_home">首頁</a>
        <a href="#overview" data-lang-key="nav_overview">王朝總覽</a>
        <a href="#timeline" data-lang-key="nav_timeline">大事年表</a>
        <a href="#territory" data-lang-key="nav_territory">疆域與地理</a>
        <a href="#emperors" data-lang-key="nav_emperors">重要皇帝</a>
        <a href="#government" data-lang-key="nav_government">政府與制度</a>
        <a href="#culture" data-lang-key="nav_culture">文化藝術</a>
        <a href="#exchange" data-lang-key="nav_exchange">國際交流</a>
        <a href="#scholars" data-lang-key="nav_scholars">士人與科技</a>
        <a href="#decline" data-lang-key="nav_decline">宋朝衰亡</a>
        <a href="#legacy" data-lang-key="nav_legacy">歷史遺產</a>
        <a href="#qingming-video" data-lang-key="nav_qingming_video">清明上河圖視頻</a>
      </div>
    </nav>

    <!-- 控制面板 -->
    <div class="control-panel">
      <button id="lang-toggle" class="control-btn" title="切換語言 / Language"><i class="fas fa-language"></i></button>
      <button id="autoplay-toggle" class="control-btn" title="自動播放 / Autoplay"><i class="fas fa-play"></i></button>
      <button id="fullscreen-toggle" class="control-btn" title="全螢幕 / Fullscreen"><i class="fas fa-expand"></i></button>
      <button id="music-toggle" class="control-btn" title="背景音樂 / Music"><i class="fas fa-volume-mute"></i></button>
      <button id="to-top-btn" class="control-btn" title="回到頂部 / Back to Top"><i class="fas fa-arrow-up"></i></button>
    </div>

    <!-- 主要內容區域 -->
    <main>

      <!-- 區塊 1: 標題頁 -->
      <section id="title" class="slide-section">
        <video autoplay loop muted playsinline style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0;">
          <source src="https://ping763573.github.io/history/03.mp4" type="video/mp4">
        </video>
        <div class="border-pattern"></div>
        <div class="tang-decoration decoration-1"></div>
        <div class="tang-decoration decoration-2"></div>
        <div class="tang-decoration decoration-3"></div>
        <div class="tang-decoration decoration-4"></div>
        <div class="title-content">
          <h1 data-lang-key="title_main">大宋王朝<br>The Song Dynasty</h1>
          <div style="font-size: 2.5rem; font-weight: 600; color: var(--accent-color); margin-top: 15px; letter-spacing: 3px; font-family: var(--elegant-font);" data-lang-key="title_dates">西元 960 - 1279 年</div>
          <h2 data-lang-key="title_subtitle">兩宋興衰與文化盛景</h2>
          <p class="title-subtitle" data-lang-key="title_presenter">一場關於政治、文化與歷史遺產的全面探索<br>大學歷史課程</p>
        </div>
        <p class="copyright-notice" data-lang-key="copyright">展示照片與配樂其版權屬原創所有；純分享勿商用。</p>
      </section>

      <!-- 區塊 2: 王朝總覽 -->
      <section id="overview" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="overview_title">王朝總覽：文人的黃金時代</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-3/5 scroll-reveal">
                <p class="text-xl leading-loose mb-6" data-lang-key="overview_p1">宋朝（西元960-1279年）是中國歷史上經濟、文化、科技高度繁榮的時代。分為北宋（960-1127）和南宋（1127-1279）兩個階段，以其精緻的藝術、發達的商業和成熟的文官政治體系而著稱。</p>
                <p class="text-xl leading-loose" data-lang-key="overview_p2">儘管軍事上長期面臨北方強鄰的壓力，宋代卻在內部創造了穩定的社會環境，催生了輝煌的物質與精神文明，其影響力深刻地塑造了後世的中國。</p>
                <div class="info-card border-l-4 border-green-800 p-6 mt-8 rounded-lg">
                  <h3 class="font-bold text-2xl text-green-800 mb-4" data-lang-key="overview_key_title">核心特徵</h3>
                  <ul class="list-none p-0 space-y-3">
                    <li class="text-lg flex items-start"><i class="fas fa-check-circle text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_1">重文輕武的基本國策</span></li>
                    <li class="text-lg flex items-start"><i class="fas fa-check-circle text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_2">經濟重心南移完成，城市商業空前繁榮</span></li>
                    <li class="text-lg flex items-start"><i class="fas fa-check-circle text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_3">儒家思想復興，理學成為主流</span></li>
                    <li class="text-lg flex items-start"><i class="fas fa-check-circle text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_4">科技發明達到高峰（活字印刷、指南針、火藥）</span></li>
                    <li class="text-lg flex items-start"><i class="fas fa-check-circle text-yellow-600 mr-3 mt-1"></i><span data-lang-key="overview_key_5">市民文化興起，文學藝術生活化</span></li>
                  </ul>
                </div>
              </div>
              <div class="lg:w-2/5 scroll-reveal" style="transition-delay: 0.2s;">
                <div class="image-container-styled h-full">
                  <img src="https://img.soundofhope.org/2017/04/qim.jpg" alt="清明上河圖局部" onerror="this.onerror=null;this.src='https://placehold.co/600x800/4A6C5B/F8F6F2?text=清明上河圖'">
                </div>
                <p class="text-sm italic mt-3 text-right" data-lang-key="overview_img_caption">《清明上河圖》局部，生動描繪了北宋首都汴京的繁華景象。</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 3: 視覺化時間軸 -->
      <section id="timeline" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="timeline_title">大宋王朝興衰史</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="visual-timeline">
              <!-- Timeline items -->
              <div class="timeline-container left scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_1_title">960年: 陳橋兵變</h3><p data-lang-key="timeline_1_desc">後周大將趙匡胤（宋太祖）「黃袍加身」，取代後周，建立宋朝，定都開封（汴京），史稱北宋。</p></div></div>
              <div class="timeline-container right scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_2_title">1004年: 澶淵之盟</h3><p data-lang-key="timeline_2_desc">宋真宗與遼國訂立和約，開啟了宋遼百餘年的和平局面，但也開創了以歲幣換取和平的模式。</p></div></div>
              <div class="timeline-container left scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_3_title">1069年: 王安石變法</h3><p data-lang-key="timeline_3_desc">宋神宗時期，王安石推行一系列改革，試圖富國強兵，但引發劇烈的黨爭，影響深遠。</p></div></div>
              <div class="timeline-container right scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_4_title">1127年: 靖康之變</h3><p data-lang-key="timeline_4_desc">金國軍隊攻破汴京，俘虜徽、欽二帝，北宋滅亡。康王趙構在南方即位，建立南宋。</p></div></div>
              <div class="timeline-container left scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_5_title">1142年: 岳飛被害</h3><p data-lang-key="timeline_5_desc">南宋抗金名將岳飛以「莫須有」罪名被害，成為南宋偏安、對金主和政策的標誌性事件。</p></div></div>
              <div class="timeline-container right scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_6_title">1234年: 宋蒙滅金</h3><p data-lang-key="timeline_6_desc">南宋與蒙古帝國聯手滅亡金國，但隨後南宋直接面對更強大的蒙古，唇亡齒寒。</p></div></div>
              <div class="timeline-container left scroll-reveal"><div class="timeline-content"><h3 data-lang-key="timeline_7_title">1279年: 崖山海戰</h3><p data-lang-key="timeline_7_desc">南宋最後的抵抗力量在崖山被元軍擊敗，丞相陸秀夫背負幼帝跳海自盡，宋朝正式滅亡。</p></div></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 4: 疆域與地理 -->
      <section id="territory" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="territory_title">疆域與地理</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-3/5 scroll-reveal">
                <div class="map-container-interactive mx-auto image-container-styled">
                  <img src="https://1001yeah.com.tw/article/images/201000540-1.jpg" alt="Map of Song Dynasty" onerror="this.onerror=null;this.src='https://placehold.co/800x600/4A6C5B/F8F6F2?text=宋朝疆域圖'">
                  <div class="hotspot" style="top: 48%; left: 70%;" data-target="info-bianjing"><i class="fas fa-star"></i></div>
                  <div class="hotspot" style="top: 58%; left: 78%;" data-target="info-linan"><i class="fas fa-star"></i></div>
                  <div class="hotspot" style="top: 68%; left: 76%;" data-target="info-quanzhou"><i class="fas fa-star"></i></div>
                  <div id="info-bianjing" class="info-box" style="top: 40%; left: 42%;"><h3 data-lang-key="map_bianjing_title">北宋汴京 (開封)</h3><p data-lang-key="map_bianjing_desc">北宋首都，位於黃河中下游平原，是當時全國的政治、經濟、文化中心，繁華程度舉世聞名。</p></div>
                  <div id="info-linan" class="info-box" style="top: 50%; left: 50%;"><h3 data-lang-key="map_linan_title">南宋臨安 (杭州)</h3><p data-lang-key="map_linan_desc">南宋首都，位於江南水鄉，風景秀麗，經濟極度繁榮，是當時世界上最大的城市之一。</p></div>
                  <div id="info-quanzhou" class="info-box" style="top: 60%; left: 48%;"><h3 data-lang-key="map_quanzhou_title">海上絲路起點 (泉州)</h3><p data-lang-key="map_quanzhou_desc">宋代最重要的對外貿易港口，被譽為「東方第一大港」，無數商船從這裡揚帆遠航。</p></div>
                </div>
                <p class="text-sm italic mt-3 text-center" data-lang-key="territory_map_caption">圖為北宋與南宋疆域疊加圖。點擊地圖上的<i class="fas fa-star text-yellow-500"></i>圖標查看更多資訊。</p>
              </div>
              <div class="lg:w-2/5 scroll-reveal" style="transition-delay: 0.2s;">
                <p class="text-xl leading-loose mb-6" data-lang-key="territory_p1">宋朝的疆域相較於漢唐較小，且未能收復燕雲十六州。北宋時期與遼、西夏並立；南宋則偏安江南，與金、西夏對峙，後來共同面臨蒙古的崛起。</p>
                <div class="info-card p-6 rounded-lg">
                  <h3 class="font-bold text-2xl text-green-800 mb-4" data-lang-key="territory_stats_title">領土數據</h3>
                  <div class="space-y-3">
                    <div class="flex justify-between text-lg border-b border-dotted border-yellow-500 pb-2"><span class="font-semibold" data-lang-key="territory_stats_1a">北宋疆域</span><span data-lang-key="territory_stats_1b">約280萬平方公里</span></div>
                    <div class="flex justify-between text-lg border-b border-dotted border-yellow-500 pb-2"><span class="font-semibold" data-lang-key="territory_stats_2a">南宋疆域</span><span data-lang-key="territory_stats_2b">約200萬平方公里</span></div>
                    <div class="flex justify-between text-lg border-b border-dotted border-yellow-500 pb-2"><span class="font-semibold" data-lang-key="territory_stats_3a">鼎盛人口</span><span data-lang-key="territory_stats_3b">超過1億 (12世紀)</span></div>
                    <div class="flex justify-between text-lg"><span class="font-semibold" data-lang-key="territory_stats_4a">主要首都</span><span data-lang-key="territory_stats_4b">開封 (北宋) / 臨安 (南宋)</span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 5: 重要皇帝 -->
      <section id="emperors" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="emperors_title">重要皇帝</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="h-60 w-full my-8 scroll-reveal">
              <canvas id="timelineChart"></canvas>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mt-4">
              <div class="styled-card scroll-reveal">
                <div class="image-container-styled mb-4" style="height: 200px;">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/71/Portrait_de_Song_Taizu.jpg/250px-Portrait_de_Song_Taizu.jpg" alt="宋太祖" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=宋太祖'">
                </div>
                <div class="border-b-2 border-yellow-500 pb-2 mb-3">
                  <div class="text-3xl font-bold text-green-800" data-lang-key="emperor_1_name" style="font-family: var(--title-font);">宋太祖 (趙匡胤)</div>
                  <div class="text-gray-600" data-lang-key="emperor_1_reign">在位: 960-976</div>
                </div>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                  <li data-lang-key="emperor_1_feat1">陳橋兵變，建立宋朝</li>
                  <li data-lang-key="emperor_1_feat2">杯酒釋兵權，確立重文輕武</li>
                  <li data-lang-key="emperor_1_feat3">結束五代十國的分裂局面</li>
                </ul>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.1s;">
                <div class="image-container-styled mb-4" style="height: 200px;">
                  <img src="https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=1278235&randomCode=639317460" alt="宋真宗" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=宋真宗'">
                </div>
                <div class="border-b-2 border-yellow-500 pb-2 mb-3">
                  <div class="text-3xl font-bold text-green-800" data-lang-key="emperor_2_name" style="font-family: var(--title-font);">宋真宗 (趙恆)</div>
                  <div class="text-gray-600" data-lang-key="emperor_2_reign">在位: 997-1022</div>
                </div>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                  <li data-lang-key="emperor_2_feat1">與遼簽訂「澶淵之盟」</li>
                  <li data-lang-key="emperor_2_feat2">勤於政事，開創「咸平之治」</li>
                  <li data-lang-key="emperor_2_feat3">晚年沉溺於祥瑞災異</li>
                </ul>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.2s;">
                <div class="image-container-styled mb-4" style="height: 200px;">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Shenzong.jpg/1200px-Shenzong.jpg" alt="宋神宗" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=宋神宗'">
                </div>
                <div class="border-b-2 border-yellow-500 pb-2 mb-3">
                  <div class="text-3xl font-bold text-green-800" data-lang-key="emperor_3_name" style="font-family: var(--title-font);">宋神宗 (趙頊)</div>
                  <div class="text-gray-600" data-lang-key="emperor_3_reign">在位: 1067-1085</div>
                </div>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                  <li data-lang-key="emperor_3_feat1">支持並推行王安石變法</li>
                  <li data-lang-key="emperor_3_feat2">力圖富國強兵，改變積弱局面</li>
                  <li data-lang-key="emperor_3_feat3">變法引發激烈新舊黨爭</li>
                </ul>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.3s;">
                <div class="image-container-styled mb-4" style="height: 200px;">
                  <img src="https://storystudio.tw/storage/upload/article/C2A000322N000000011PAA.png" alt="宋高宗" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=宋高宗'">
                </div>
                <div class="border-b-2 border-yellow-500 pb-2 mb-3">
                  <div class="text-3xl font-bold text-green-800" data-lang-key="emperor_4_name" style="font-family: var(--title-font);">宋高宗 (趙構)</div>
                  <div class="text-gray-600" data-lang-key="emperor_4_reign">在位: 1127-1162</div>
                </div>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                  <li data-lang-key="emperor_4_feat1">建立南宋，定都臨安</li>
                  <li data-lang-key="emperor_4_feat2">處死名將岳飛，對金求和</li>
                  <li data-lang-key="emperor_4_feat3">統治前期政局動盪，後期穩定</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 6: 政府與制度 -->
      <section id="government" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="gov_title">政府與制度</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-1/2 flex flex-col gap-8">
                <div class="styled-card scroll-reveal">
                  <h3 class="text-2xl text-green-800 mb-3 flex items-center font-bold"><i class="fas fa-university mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="gov_box1_title">文官體制強化</span></h3>
                  <p class="leading-relaxed" data-lang-key="gov_box1_desc">宋代極力擴大科舉取士規模，確立「與士大夫共治天下」的原則。文官地位空前提高，掌握了國家絕大部分的行政與軍事權力。</p>
                </div>
                <div class="styled-card scroll-reveal" style="transition-delay: 0.1s;">
                  <h3 class="text-2xl text-green-800 mb-3 flex items-center font-bold"><i class="fas fa-landmark mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="gov_box2_title">二府三司制</span></h3>
                  <p class="leading-relaxed" data-lang-key="gov_box2_desc">中央政府架空三省，實行二府（樞密院管軍事，中書門下管行政）和三司（管財政）的體系，實現軍、政、財權力分立，皇權高度集中。</p>
                </div>
                <div class="styled-card scroll-reveal" style="transition-delay: 0.2s;">
                  <h3 class="text-2xl text-green-800 mb-3 flex items-center font-bold"><i class="fas fa-shield-alt mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="gov_box3_title">強幹弱枝政策</span></h3>
                  <p class="leading-relaxed" data-lang-key="gov_box3_desc">為防止唐末藩鎮割據重演，宋朝將精銳部隊集中於京師，地方軍力薄弱。此舉雖鞏固了中央集權，但也導致邊防空虛，軍事積弱。</p>
                </div>
              </div>
              <div class="lg:w-1/2 scroll-reveal" style="transition-delay: 0.3s;">
                <div class="h-96 w-full p-4 bg-white/80 rounded-lg shadow-inner">
                  <canvas id="governmentChart"></canvas>
                </div>
                <p class="text-center mt-4 text-sm" data-lang-key="gov_chart_caption">圖表顯示宋代文官與武官的相對數量。文官集團（綠色）持續擴大，而武官（灰色）的地位與數量則相對受限，反映了重文輕武的國策。</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 7: 文化藝術 -->
      <section id="culture" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="culture_title">文化藝術</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <p class="text-center text-xl max-w-4xl mx-auto mb-12 scroll-reveal leading-relaxed" data-lang-key="culture_intro">宋代是中國文化藝術的又一高峰。在理學思想的影響下，藝術風格趨向內斂、理性與雅致，追求平淡天真的意境，美學成就極高。</p>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
              <div class="styled-card flex flex-col md:flex-row bg-white overflow-hidden scroll-reveal">
                <div class="image-container-styled md:w-1/3 flex-shrink-0">
                  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRIM7YpH-LKohXEureGG8OwqPLtI3QWNiDEog&s" alt="蘇軾《寒食帖》" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=宋詞書法'">
                </div>
                <div class="p-5 flex flex-col justify-center flex-grow">
                  <h3 class="text-2xl text-green-800 font-bold mb-3 flex items-center"><i class="fas fa-pen-fancy mr-3 text-yellow-600"></i><span data-lang-key="culture_card1_title">宋詞與書法</span></h3>
                  <p data-lang-key="culture_card1_desc">詞發展至巔峰，出現了蘇軾、李清照、辛棄疾等偉大詞人。書法四大家「蘇、黃、米、蔡」追求意趣，開創了尚意書風。</p>
                  <div class="text-lg italic text-gray-700 mt-4 pl-4 border-l-4 border-yellow-500" data-lang-key="culture_card1_quote" style="font-family: var(--cursive-font);">"大江東去，浪淘盡，千古風流人物。" <br>— 蘇軾</div>
                </div>
              </div>
              <div class="styled-card flex flex-col md:flex-row bg-white overflow-hidden scroll-reveal" style="transition-delay: 0.1s;">
                <div class="image-container-styled md:w-1/3 flex-shrink-0">
                  <img src="https://gw.alicdn.com/imgextra/i4/1926997091/O1CN01bczLge22Fj8hzEpTp_!!0-item_pic.jpg_Q75.jpg_.webp" alt="宋代汝窯瓷器" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=宋代瓷器'">
                </div>
                <div class="p-5 flex flex-col justify-center flex-grow">
                  <h3 class="text-2xl text-green-800 font-bold mb-3 flex items-center"><i class="fas fa-gem mr-3 text-yellow-600"></i><span data-lang-key="culture_card2_title">山水畫與瓷器</span></h3>
                  <p data-lang-key="culture_card2_desc">山水畫達到極致，重視意境與哲理的表達。五大名窯（汝、官、哥、鈞、定）所產的瓷器，以其簡約、典雅的造型和釉色聞名於世。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 8: 國際交流 -->
      <section id="exchange" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="exchange_title">國際交流</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-3/5">
                <p class="text-xl leading-loose mb-8 scroll-reveal" data-lang-key="exchange_intro">由於陸上絲路受阻，宋代大力發展海上貿易。指南針的廣泛應用使得遠洋航行成為可能，中國的商船、商品和文化以前所未有的規模走向世界。</p>
                <div class="space-y-6">
                  <div class="styled-card scroll-reveal" style="transition-delay: 0.1s;">
                    <h3 class="text-xl font-bold text-green-800 mb-2 flex items-center"><i class="fas fa-ship mr-3 text-yellow-600"></i><span data-lang-key="exchange_box1_title">海上絲綢之路</span></h3>
                    <p data-lang-key="exchange_box1_desc">以泉州、廣州為中心的海上貿易網絡極其發達，航線遠達波斯灣、東非。瓷器、絲綢、茶葉是主要出口商品，換回香料、珠寶等。</p>
                  </div>
                  <div class="styled-card scroll-reveal" style="transition-delay: 0.2s;">
                    <h3 class="text-xl font-bold text-green-800 mb-2 flex items-center"><i class="fas fa-landmark mr-3 text-yellow-600"></i><span data-lang-key="exchange_box2_title">市舶司與貿易管理</span></h3>
                    <p data-lang-key="exchange_box2_desc">宋政府在主要港口設立市舶司，專門管理對外貿易和徵收關稅，顯示了海外貿易在國家財政中的重要地位。</p>
                  </div>
                </div>
              </div>
              <div class="lg:w-2/5 scroll-reveal" style="transition-delay: 0.3s;">
                <div class="h-80 w-full mb-8 p-4 bg-white/80 rounded-lg shadow-inner">
                  <canvas id="relationChart"></canvas>
                </div>
                <div class="image-container-styled">
                    <img src="https://img.imsilkroad.com/a/10001/202001/15aabe0c2c5a5e0f2be12f01f210b5b7.jpeg" alt="宋代海上貿易路線" class="w-full rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=海上貿易'">
                </div>
                <p class="text-sm italic mt-3 text-center" data-lang-key="exchange_img_caption">宋代海上貿易路線示意圖，展現了其廣泛的海洋聯繫。</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 9: 士人與科技 -->
      <section id="scholars" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="scholars_title">士人與科技</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <p class="text-center text-xl max-w-4xl mx-auto mb-12 scroll-reveal leading-relaxed" data-lang-key="scholars_intro">宋代是中國科技史上的高峰期，三大發明（活字印刷、指南針、火藥）在這一時期得到發展和廣泛應用。同時，士人階層的博學多才，使得人文與科學交相輝映。</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
              <div class="scholar-card scroll-reveal">
                <div class="scholar-img">
                  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS3UHxHt6LOhaMM7K3jP9CwLVlmwu796pOY8Q&s" alt="蘇軾" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=蘇軾'">
                </div>
                <div class="scholar-content">
                  <h3 class="scholar-name" data-lang-key="scholar_1_name">蘇軾</h3>
                  <p class="scholar-desc" data-lang-key="scholar_1_desc">北宋文學家、書畫家，文、詩、詞、書、畫無一不精，是中國歷史上罕見的全才。其詞作開創豪放派，性格豁達樂觀。</p>
                </div>
              </div>
              
              <div class="scholar-card scroll-reveal" style="transition-delay: 0.1s;">
                <div class="scholar-img">
                  <img src="https://swarma.org/wp-content/uploads/2021/05/wxsync-2021-05-8aac97c75ab74c4eba35dd4215c1d6c8.png" alt="沈括" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=沈括'">
                </div>
                <div class="scholar-content">
                  <h3 class="scholar-name" data-lang-key="scholar_2_name">沈括</h3>
                  <p class="scholar-desc" data-lang-key="scholar_2_desc">北宋科學家，著作《夢溪筆談》被譽為「中國科學史上的座標」，內容涵蓋天文、物理、數學、地質、醫學等多個領域。</p>
                </div>
              </div>
              
              <div class="scholar-card scroll-reveal" style="transition-delay: 0.2s;">
                <div class="scholar-img">
                  <img src="https://pub.cjps.ntpc.edu.tw/~cni101001/rixing/images/activity%20images/history/history02-1-01s.jpg" alt="畢昇" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=畢昇'">
                </div>
                <div class="scholar-content">
                  <h3 class="scholar-name" data-lang-key="scholar_3_name">畢昇</h3>
                  <p class="scholar-desc" data-lang-key="scholar_3_desc">活字印刷術的發明者。他發明的膠泥活字，大大提高了印刷效率，是印刷史上的一次偉大革命，對世界文明產生深遠影響。</p>
                </div>
              </div>
              
              <div class="scholar-card scroll-reveal" style="transition-delay: 0.3s;">
                <div class="scholar-img">
                  <img src="https://p5.itc.cn/images01/20230921/2de94afbdda544839f33c9d3a4f048ad.png" alt="張擇端" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=張擇端'">
                </div>
                <div class="scholar-content">
                  <h3 class="scholar-name" data-lang-key="scholar_4_name">張擇端</h3>
                  <p class="scholar-desc" data-lang-key="scholar_4_desc">北宋著名畫家，其傳世名作《清明上河圖》是中國十大傳世名畫之一，以精緻的工筆描繪了汴京的繁榮景象和市井生活。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 10: 宋朝衰亡 -->
      <section id="decline" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="decline_title">宋朝衰亡</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <p class="text-center text-xl max-w-4xl mx-auto mb-12 scroll-reveal leading-relaxed" data-lang-key="decline_intro">宋朝的滅亡是一個漫長而悲壯的過程。北宋亡於新興的女真（金），南宋則在抵抗蒙古（元）的長期戰爭中，最終耗盡國力，以崖山之役的集體殉國告終。</p>
            <div class="flex flex-col lg:flex-row items-center gap-12 mt-8">
              <div class="lg:w-1/2 scroll-reveal">
                <div class="h-96 w-full p-4 bg-white/80 rounded-lg shadow-inner">
                  <canvas id="declineChart"></canvas>
                </div>
                <p class="text-center mt-4 text-sm" data-lang-key="decline_chart_caption">圖表直觀顯示了宋朝國力（綠色）與北方政權威脅（灰色）的消長。宋朝雖長期維持高度文明，但最終在持續的軍事壓力下覆滅。</p>
              </div>
              <div class="lg:w-1/2 flex flex-col gap-8 scroll-reveal" style="transition-delay: 0.2s;">
                <div class="styled-card">
                  <h3 class="text-2xl text-green-800 mb-3 flex items-center font-bold"><i class="fas fa-mountain mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="decline_box1_title">靖康之恥與金滅北宋</span></h3>
                  <p class="leading-relaxed" data-lang-key="decline_box1_desc">由於外交失策和軍事積弱，金軍攻破汴京，俘走徽欽二帝，導致北宋滅亡。這是漢族政權史上的一大恥辱。</p>
                </div>
                <div class="styled-card">
                  <h3 class="text-2xl text-green-800 mb-3 flex items-center font-bold"><i class="fas fa-water mr-4 text-yellow-600 text-3xl"></i><span data-lang-key="decline_box2_title">崖山海戰與南宋覆滅</span></h3>
                  <p class="leading-relaxed" data-lang-key="decline_box2_desc">在蒙古的強大攻勢下，南宋軍民進行了數十年的頑強抵抗。1279年，最後的抵抗力量在崖山海戰中全軍覆沒，標誌著宋朝徹底滅亡。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 11: 歷史遺產 -->
      <section id="legacy" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="legacy_title">歷史遺產</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            <p class="text-center text-xl max-w-4xl mx-auto mb-12 scroll-reveal leading-relaxed" data-lang-key="legacy_intro">儘管宋朝最終亡於外族，但其創造的輝煌文明深刻地影響了後來的元、明、清三代，甚至整個東亞世界。宋代奠定的許多文化範式和生活方式，至今仍是中華文化的重要組成部分。</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
              <div class="styled-card scroll-reveal">
                <h3 class="text-xl font-bold text-green-800 mb-3 flex items-center"><i class="fas fa-university mr-3 text-yellow-600"></i><span data-lang-key="legacy_box1_title">思想與制度遺產</span></h3>
                <p class="leading-relaxed" data-lang-key="legacy_box1_desc">宋代發展成熟的理學思想，成為後世官方哲學。其建立的文官政治體系和中央集權模式，為明清所繼承和強化。</p>
              </div>
              <div class="styled-card scroll-reveal" style="transition-delay: 0.1s;">
                <h3 class="text-xl font-bold text-green-800 mb-3 flex items-center"><i class="fas fa-palette mr-3 text-yellow-600"></i><span data-lang-key="legacy_box2_title">文化與審美遺產</span></h3>
                <p class="leading-relaxed" data-lang-key="legacy_box2_desc">宋詞、山水畫、宋瓷等藝術形式成為中國美學的典範。宋代興起的市民文化、飲茶文化等生活方式，至今仍影響著現代華人社會。</p>
              </div>
            </div>
            <div class="quote-block p-8 my-8 scroll-reveal rounded-lg">
              <p class="text-2xl italic leading-relaxed" data-lang-key="legacy_quote">"宋代是中國的『第一次現代化』，其物質文明、精神文明和制度文明都達到了前所未有的高度。"</p>
              <p class="text-right font-semibold mt-4 text-lg" data-lang-key="legacy_quote_author">— 內藤湖南 (Naitō Konan)，日本歷史學家</p>
            </div>
          </div>
        </div>
      </section>

      <!-- 區塊 12: 清明上河圖視頻 -->
      <section id="qingming-video" class="slide-section has-bg-image">
        <div class="w-full">
          <div class="content-container">
            <h2 class="section-title scroll-reveal" data-lang-key="qingming_video_title">清明上河圖AI模擬視頻</h2><button class="tts-btn ml-4 px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600" data-tts-target data-lang-key="tts_play_btn">🔊 語音導讀</button>
            
            <!-- Responsive Embed for Google Drive -->
            <div class="scroll-reveal my-8" style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; border-radius: 15px; box-shadow: 0 15px 40px rgba(0,0,0,0.3); border: 3px solid var(--accent-light);">
              <iframe 
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                src="https://drive.google.com/file/d/1_H61PNuxuRQMPc9JXxQUv8bip3lBWOJJ/preview" 
                title="Google Drive video player" 
                frameborder="0" 
                allow="autoplay" 
                allowfullscreen>
              </iframe>
            </div>

            <p class="text-xl leading-loose max-w-4xl mx-auto mt-10 scroll-reveal" data-lang-key="qingming_video_desc">
              <!-- Content will be injected by JavaScript -->
            </p>
          </div>
        </div>
      </section>

    </main>

    <script>
    // --- 翻譯資料 ---
    const translations = {
      'zh-TW': {
        nav_home: '首頁', nav_overview: '王朝總覽', nav_timeline: '大事年表', nav_territory: '疆域與地理', nav_emperors: '重要皇帝', nav_government: '政府與制度', nav_culture: '文化藝術', nav_exchange: '國際交流', nav_scholars: '士人與科技', nav_decline: '宋朝衰亡', nav_legacy: '歷史遺產', nav_qingming_video: '清明上河圖視頻',
        title_main: '大宋王朝<br>The Song Dynasty', title_dates: '西元 960 - 1279 年', title_subtitle: '兩宋興衰與文化盛景', title_presenter: '一場關於政治、文化與歷史遺產的全面探索<br>大學歷史課程',
        copyright: '展示照片與配樂其版權屬原創所有；純分享勿商用。',
        tts_play_btn: '🔊 語音導讀', tts_stop_btn: '⏹️ 停止導讀',
        overview_title: '王朝總覽：文人的黃金時代',
        overview_p1: '宋朝（西元960-1279年）是中國歷史上經濟、文化、科技高度繁榮的時代。分為北宋（960-1127）和南宋（1127-1279）兩個階段，以其精緻的藝術、發達的商業和成熟的文官政治體系而著稱。',
        overview_p2: '儘管軍事上長期面臨北方強鄰的壓力，宋代卻在內部創造了穩定的社會環境，催生了輝煌的物質與精神文明，其影響力深刻地塑造了後世的中國。',
        overview_key_title: '核心特徵',
        overview_key_1: '重文輕武的基本國策', overview_key_2: '經濟重心南移完成，城市商業空前繁榮', overview_key_3: '儒家思想復興，理學成為主流', overview_key_4: '科技發明達到高峰（活字印刷、指南針、火藥）', overview_key_5: '市民文化興起，文學藝術生活化',
        overview_img_caption: '《清明上河圖》局部，生動描繪了北宋首都汴京的繁華景象。',
        timeline_title: '大宋王朝興衰史',
        timeline_1_title: '960年: 陳橋兵變', timeline_1_desc: '後周大將趙匡胤（宋太祖）「黃袍加身」，取代後周，建立宋朝，定都開封（汴京），史稱北宋。',
        timeline_2_title: '1004年: 澶淵之盟', timeline_2_desc: '宋真宗與遼國訂立和約，開啟了宋遼百餘年的和平局面，但也開創了以歲幣換取和平的模式。',
        timeline_3_title: '1069年: 王安石變法', timeline_3_desc: '宋神宗時期，王安石推行一系列改革，試圖富國強兵，但引發劇烈的黨爭，影響深遠。',
        timeline_4_title: '1127年: 靖康之變', timeline_4_desc: '金國軍隊攻破汴京，俘虜徽、欽二帝，北宋滅亡。康王趙構在南方即位，建立南宋。',
        timeline_5_title: '1142年: 岳飛被害', timeline_5_desc: '南宋抗金名將岳飛以「莫須有」罪名被害，成為南宋偏安、對金主和政策的標誌性事件。',
        timeline_6_title: '1234年: 宋蒙滅金', timeline_6_desc: '南宋與蒙古帝國聯手滅亡金國，但隨後南宋直接面對更強大的蒙古，唇亡齒寒。',
        timeline_7_title: '1279年: 崖山海戰', timeline_7_desc: '南宋最後的抵抗力量在崖山被元軍擊敗，丞相陸秀夫背負幼帝跳海自盡，宋朝正式滅亡。',
        territory_title: '疆域與地理',
        territory_map_caption: '圖為北宋與南宋疆域疊加圖。點擊地圖上的<i class="fas fa-star text-yellow-500"></i>圖標查看更多資訊。',
        territory_p1: '宋朝的疆域相較於漢唐較小，且未能收復燕雲十六州。北宋時期與遼、西夏並立；南宋則偏安江南，與金、西夏對峙，後來共同面臨蒙古的崛起。',
        territory_stats_title: '領土數據',
        territory_stats_1a: '北宋疆域', territory_stats_1b: '約280萬平方公里',
        territory_stats_2a: '南宋疆域', territory_stats_2b: '約200萬平方公里',
        territory_stats_3a: '鼎盛人口', territory_stats_3b: '超過1億 (12世紀)',
        territory_stats_4a: '主要首都', territory_stats_4b: '開封 (北宋) / 臨安 (南宋)',
        map_bianjing_title: '北宋汴京 (開封)', map_bianjing_desc: '北宋首都，位於黃河中下游平原，是當時全國的政治、經濟、文化中心，繁華程度舉世聞名。',
        map_linan_title: '南宋臨安 (杭州)', map_linan_desc: '南宋首都，位於江南水鄉，風景秀麗，經濟極度繁榮，是當時世界上最大的城市之一。',
        map_quanzhou_title: '海上絲路起點 (泉州)', map_quanzhou_desc: '宋代最重要的對外貿易港口，被譽為「東方第一大港」，無數商船從這裡揚帆遠航。',
        emperors_title: '重要皇帝',
        emperor_1_name: '宋太祖 (趙匡胤)', emperor_1_reign: '在位: 960-976', emperor_1_feat1: '陳橋兵變，建立宋朝', emperor_1_feat2: '杯酒釋兵權，確立重文輕武', emperor_1_feat3: '結束五代十國的分裂局面',
        emperor_2_name: '宋真宗 (趙恆)', emperor_2_reign: '在位: 997-1022', emperor_2_feat1: '與遼簽訂「澶淵之盟」', emperor_2_feat2: '勤於政事，開創「咸平之治」', emperor_2_feat3: '晚年沉溺於祥瑞災異',
        emperor_3_name: '宋神宗 (趙頊)', emperor_3_reign: '在位: 1067-1085', emperor_3_feat1: '支持並推行王安石變法', emperor_3_feat2: '力圖富國強兵，改變積弱局面', emperor_3_feat3: '變法引發激烈新舊黨爭',
        emperor_4_name: '宋高宗 (趙構)', emperor_4_reign: '在位: 1127-1162', emperor_4_feat1: '建立南宋，定都臨安', emperor_4_feat2: '處死名將岳飛，對金求和', emperor_4_feat3: '統治前期政局動盪，後期穩定',
        gov_title: '政府與制度',
        gov_box1_title: '文官體制強化', gov_box1_desc: '宋代極力擴大科舉取士規模，確立「與士大夫共治天下」的原則。文官地位空前提高，掌握了國家絕大部分的行政與軍事權力。',
        gov_box2_title: '二府三司制', gov_box2_desc: '中央政府架空三省，實行二府（樞密院管軍事，中書門下管行政）和三司（管財政）的體系，實現軍、政、財權力分立，皇權高度集中。',
        gov_box3_title: '強幹弱枝政策', gov_box3_desc: '為防止唐末藩鎮割據重演，宋朝將精銳部隊集中於京師，地方軍力薄弱。此舉雖鞏固了中央集權，但也導致邊防空虛，軍事積弱。',
        gov_chart_caption: '圖表顯示宋代文官與武官的相對數量。文官集團（綠色）持續擴大，而武官（灰色）的地位與數量則相對受限，反映了重文輕武的國策。',
        culture_title: '文化藝術',
        culture_intro: '宋代是中國文化藝術的又一高峰。在理學思想的影響下，藝術風格趨向內斂、理性與雅致，追求平淡天真的意境，美學成就極高。',
        culture_card1_title: '宋詞與書法', culture_card1_desc: '詞發展至巔峰，出現了蘇軾、李清照、辛棄疾等偉大詞人。書法四大家「蘇、黃、米、蔡」追求意趣，開創了尚意書風。',
        culture_card1_quote: '"大江東去，浪淘盡，千古風流人物。" <br>— 蘇軾',
        culture_card2_title: '山水畫與瓷器', culture_card2_desc: '山水畫達到極致，重視意境與哲理的表達。五大名窯（汝、官、哥、鈞、定）所產的瓷器，以其簡約、典雅的造型和釉色聞名于世。',
        exchange_title: '國際交流',
        exchange_intro: '由於陸上絲路受阻，宋代大力發展海上貿易。指南針的廣泛應用使得遠洋航行成為可能，中國的商船、商品和文化以前所未有的規模走向世界。',
        exchange_box1_title: '海上絲綢之路', exchange_box1_desc: '以泉州、廣州為中心的海上貿易網絡極其發達，航線遠達波斯灣、東非。瓷器、絲綢、茶葉是主要出口商品，換回香料、珠寶等。',
        exchange_box2_title: '市舶司與貿易管理', exchange_box2_desc: '宋政府在主要港口設立市舶司，專門管理對外貿易和徵收關稅，顯示了海外貿易在國家財政中的重要地位。',
        exchange_img_caption: '宋代海上貿易路線示意圖，展現了其廣泛的海洋聯繫。',
        scholars_title: '士人與科技',
        scholars_intro: '宋代是中國科技史上的高峰期，三大發明（活字印刷、指南針、火藥）在這一時期得到發展和廣泛應用。同時，士人階層的博學多才，使得人文與科學交相輝映。',
        scholar_1_name: '蘇軾', scholar_1_desc: '北宋文學家、書畫家，文、詩、詞、書、畫無一不精，是中國歷史上罕見的全才。其詞作開創豪放派，性格豁達樂觀。',
        scholar_2_name: '沈括', scholar_2_desc: '北宋科學家，著作《夢溪筆談》被譽為「中國科學史上的座標」，內容涵蓋天文、物理、數學、地質、醫學等多個領域。',
        scholar_3_name: '畢昇', scholar_3_desc: '活字印刷術的發明者。他發明的膠泥活字，大大提高了印刷效率，是印刷史上的一次偉大革命，對世界文明產生深遠影響。',
        scholar_4_name: '張擇端', scholar_4_desc: '北宋著名畫家，其傳世名作《清明上河圖》是中國十大傳世名畫之一，以精緻的工筆描繪了汴京的繁榮景象和市井生活。',
        decline_title: '宋朝衰亡',
        decline_intro: '宋朝的滅亡是一個漫長而悲壯的過程。北宋亡於新興的女真（金），南宋則在抵抗蒙古（元）的長期戰爭中，最終耗盡國力，以崖山之役的集體殉國告終。',
        decline_chart_caption: '圖表直觀顯示了宋朝國力（綠色）與北方政權威脅（灰色）的消長。宋朝雖長期維持高度文明，但最終在持續的軍事壓力下覆滅。',
        decline_box1_title: '靖康之恥與金滅北宋', decline_box1_desc: '由於外交失策和軍事積弱，金軍攻破汴京，俘走徽欽二帝，導致北宋滅亡。這是漢族政權史上的一大恥辱。',
        decline_box2_title: '崖山海戰與南宋覆滅', decline_box2_desc: '在蒙古的強大攻勢下，南宋軍民進行了數十年的頑強抵抗。1279年，最後的抵抗力量在崖山海戰中全軍覆沒，標誌著宋朝徹底滅亡。',
        legacy_title: '歷史遺產',
        legacy_intro: '儘管宋朝最終亡於外族，但其創造的輝煌文明深刻地影響了後來的元、明、清三代，甚至整個東亞世界。宋代奠定的許多文化範式和生活方式，至今仍是中華文化的重要組成部分。',
        legacy_box1_title: '思想與制度遺產', legacy_box1_desc: '宋代發展成熟的理學思想，成為後世官方哲學。其建立的文官政治體系和中央集權模式，為明清所繼承和強化。',
        legacy_box2_title: '文化與審美遺產', legacy_box2_desc: '宋詞、山水畫、宋瓷等藝術形式成為中國美學的典範。宋代興起的市民文化、飲茶文化等生活方式，至今仍影響著現代華人社會。',
        legacy_quote: '"宋代是中國的『第一次現代化』，其物質文明、精神文明和制度文明都達到了前所未有的高度。"',
        legacy_quote_author: '— 內藤湖南 (Naitō Konan)，日本歷史學家',
        qingming_video_title: '清明上河圖AI模擬視頻',
        qingming_video_desc: '<strong>關於《清明上河圖》</strong><br><br>《清明上河圖》是北宋畫家張擇端的傳世傑作，為中國十大傳世名畫之一。此畫以長卷形式，採用散點透視構圖法，生動記錄了北宋首都汴京（今河南開封）在清明時節的繁榮景象和社會各階層人民的生活狀況。<br><br>全圖可分為三段：首段描繪京郊的田園風光，中段聚焦於汴河上的繁忙運輸與虹橋周邊的熱鬧景象，末段則展現了市區街道的繁華與各色店鋪、人物。畫中人物超過800位，牲畜60多匹，船隻20餘艘，細節之豐富、描繪之精細，使其成為研究宋代城市生活、經濟文化、民俗風情的珍貴歷史文獻。',
        chart_timeline_labels: ['太祖', '真宗', '神宗', '高宗', '晚期'],
        chart_gov_title: '宋代官僚體系趨勢 (相對值)',
        chart_gov_label_central: '文官數量', chart_gov_label_provincial: '武官數量', chart_gov_yaxis: '相對數量指數',
        chart_rel_title: '宋朝海上貿易網絡',
        chart_rel_label: '貿易交流強度', chart_rel_cats: ['日本', '高麗', '東南亞', '阿拉伯', '波斯', '印度'],
        chart_dec_title: '宋代國力與外患消長圖',
        chart_dec_label_central: '宋朝國力', chart_dec_label_regional: '北方威脅 (遼/金/元)', chart_dec_yaxis: '相對實力指數',
      },
      'en': {
        nav_home: 'Home', nav_overview: 'Overview', nav_timeline: 'Timeline', nav_territory: 'Territory', nav_emperors: 'Emperors', nav_government: 'Government', nav_culture: 'Culture & Art', nav_exchange: 'Exchange', nav_scholars: 'Scholars & Tech', nav_decline: 'Decline', nav_legacy: 'Legacy', nav_qingming_video: 'Qingming Scroll Video',
        title_main: 'The Song Dynasty', title_dates: '960 - 1279 CE', title_subtitle: 'The Rise, Fall, and Cultural Splendor of Two Songs', title_presenter: 'A Comprehensive Exploration of Politics, Culture, and Legacy<br>University History Course',
        copyright: 'The copyright of photos and music belongs to the original creators. For sharing purposes only, not for commercial use.',
        tts_play_btn: '🔊 Read Aloud', tts_stop_btn: '⏹️ Stop Reading',
        overview_title: 'Overview: The Golden Age of Scholars',
        overview_p1: 'The Song Dynasty (960-1279 CE) was an era of great economic, cultural, and technological prosperity in Chinese history. Divided into two periods, the Northern Song (960-1127) and the Southern Song (1127-1279), it is renowned for its sophisticated art, advanced commerce, and mature civil bureaucracy.',
        overview_p2: 'Despite long-term military pressure from powerful northern neighbors, the Song Dynasty created a stable domestic environment that fostered brilliant material and spiritual civilizations, profoundly shaping later Chinese history.',
        overview_key_title: 'Key Characteristics',
        overview_key_1: 'Emphasis on civilian rule over military power', overview_key_2: 'Completion of the southward shift of the economic center', overview_key_3: 'Revival of Confucianism, with Neo-Confucianism becoming mainstream', overview_key_4: 'Peak of technological inventions (printing, compass, gunpowder)', overview_key_5: 'Rise of urban citizen culture and secularization of arts',
        overview_img_caption: 'A section from "Along the River During the Qingming Festival," vividly depicting the prosperity of the Northern Song capital, Bianjing.',
        timeline_title: 'Rise and Fall of the Song Dynasty',
        timeline_1_title: '960 CE: Coup at Chen Bridge', timeline_1_desc: 'General Zhao Kuangyin (Emperor Taizu) is acclaimed emperor, establishing the Song Dynasty and ending the Five Dynasties period.',
        timeline_2_title: '1004 CE: Treaty of Chanyuan', timeline_2_desc: 'Emperor Zhenzong signs a peace treaty with the Khitan Liao state, securing over a century of peace in exchange for annual tribute.',
        timeline_3_title: '1069 CE: Wang Anshi Reforms', timeline_3_desc: 'Under Emperor Shenzong, Wang Anshi launches major reforms to enrich the state and strengthen the army, sparking intense factional conflict.',
        timeline_4_title: '1127 CE: Jingkang Incident', timeline_4_desc: 'Jurchen (Jin) armies capture the capital Bianjing and two emperors, ending the Northern Song. Zhao Gou establishes the Southern Song.',
        timeline_5_title: '1142 CE: Execution of Yue Fei', timeline_5_desc: 'The celebrated general Yue Fei is executed on trumped-up charges, symbolizing the Southern Song\'s policy of appeasement towards the Jin.',
        timeline_6_title: '1234 CE: Song-Mongol Conquest of Jin', timeline_6_desc: 'The Southern Song allies with the Mongols to destroy the Jin Dynasty, only to face the more formidable Mongol threat directly.',
        timeline_7_title: '1279 CE: Battle of Yamen', timeline_7_desc: 'The last Song resistance is annihilated by the Mongol-led Yuan navy. The Song Dynasty officially ends.',
        territory_title: 'Territory & Geography',
        territory_map_caption: 'Map showing the overlapping territories of the Northern and Southern Song. Click the <i class="fas fa-star text-yellow-500"></i> icons for more info.',
        territory_p1: 'Compared to the Han and Tang, the Song Dynasty\'s territory was smaller. The Northern Song coexisted with the Liao and Western Xia, while the Southern Song was confined to the south of the Yangtze River, confronting the Jin and later the Mongols.',
        territory_stats_title: 'Territorial Statistics',
        territory_stats_1a: 'N. Song Area', territory_stats_1b: '≈2.8 million km²',
        territory_stats_2a: 'S. Song Area', territory_stats_2b: '≈2.0 million km²',
        territory_stats_3a: 'Peak Population', territory_stats_3b: '>100 million (12th c.)',
        territory_stats_4a: 'Main Capitals', territory_stats_4b: 'Kaifeng (N. Song) / Lin\'an (S. Song)',
        map_bianjing_title: 'Bianjing (Kaifeng)', map_bianjing_desc: 'The Northern Song capital, a political, economic, and cultural hub, famed for its world-leading prosperity.',
        map_linan_title: 'Lin\'an (Hangzhou)', map_linan_desc: 'The Southern Song capital, a scenic and economically vibrant city, and one of the largest in the world at the time.',
        map_quanzhou_title: 'Maritime Silk Road Hub', map_quanzhou_desc: 'The most important foreign trade port, known as the "greatest port in the East," from which countless merchant ships set sail.',
        emperors_title: 'Major Emperors',
        emperor_1_name: 'Emperor Taizu (Zhao Kuangyin)', emperor_1_reign: 'Reign: 960-976', emperor_1_feat1: 'Founded the Song Dynasty', emperor_1_feat2: 'Established civilian control over the military', emperor_1_feat3: 'Ended the fragmentation of the Five Dynasties',
        emperor_2_name: 'Emperor Zhenzong (Zhao Heng)', emperor_2_reign: 'Reign: 997-1022', emperor_2_feat1: 'Signed the Treaty of Chanyuan with Liao', emperor_2_feat2: 'Oversaw a period of peace and prosperity', emperor_2_feat3: 'Became obsessed with Daoist omens later in life',
        emperor_3_name: 'Emperor Shenzong (Zhao Xu)', emperor_3_reign: 'Reign: 1067-1085', emperor_3_feat1: 'Championed the Wang Anshi Reforms', emperor_3_feat2: 'Sought to enrich the state and strengthen the army', emperor_3_feat3: 'His reforms led to intense political infighting',
        emperor_4_name: 'Emperor Gaozong (Zhao Gou)', emperor_4_reign: 'Reign: 1127-1162', emperor_4_feat1: 'Founded the Southern Song Dynasty', emperor_4_feat2: 'Ordered the execution of General Yue Fei', emperor_4_feat3: 'Stabilized the state after the fall of the north',
        gov_title: 'Government & Administration',
        gov_box1_title: 'Civilian Bureaucracy', gov_box1_desc: 'The Song vastly expanded the civil service examination system, establishing a principle of "ruling with the scholar-officials." Civilian officials enjoyed unprecedented status and power.',
        gov_box2_title: 'Two Offices, Three Departments', gov_box2_desc: 'The central government was led by the Bureau of Military Affairs and the Secretariat-Chancellery, with a separate finance commission, ensuring a separation of military, administrative, and fiscal power under the emperor.',
        gov_box3_title: 'Strong Trunk, Weak Branches', gov_box3_desc: 'To prevent regional warlordism, the Song concentrated elite troops in the capital, leaving provincial armies weak. This secured central control but weakened border defenses.',
        gov_chart_caption: 'The chart shows the relative numbers of civil and military officials. The civilian bureaucracy (green) expanded, while the military\'s status (gray) was curtailed, reflecting state policy.',
        culture_title: 'Culture & Art',
        culture_intro: 'The Song Dynasty was another peak in Chinese cultural history. Influenced by Neo-Confucianism, art trended towards introspection, rationality, and elegance, achieving a sublime aesthetic.',
        culture_card1_title: 'Ci Poetry & Calligraphy', culture_card1_desc: 'Ci poetry reached its apex with masters like Su Shi and Li Qingzhao. The "Four Masters" of calligraphy prioritized personal expression and artistic intent.',
        culture_card1_quote: '"The great river flows east, its waves have washed away, all the heroes of a thousand ages." <br>— Su Shi',
        culture_card2_title: 'Landscape Painting & Ceramics', culture_card2_desc: 'Landscape painting reached its zenith, emphasizing philosophical meaning. The "Five Great Kilns" produced ceramics famed for their simple, elegant forms and glazes.',
        exchange_title: 'International Exchange',
        exchange_intro: 'With the land-based Silk Road obstructed, the Song vigorously developed maritime trade. The widespread use of the compass enabled long-distance sea voyages, spreading Chinese goods and culture on an unprecedented scale.',
        exchange_box1_title: 'Maritime Silk Road', exchange_box1_desc: 'Centered on ports like Quanzhou and Guangzhou, the maritime network reached the Persian Gulf and East Africa. Porcelain, silk, and tea were exchanged for spices and jewels.',
        exchange_box2_title: 'Maritime Trade Bureaus', exchange_box2_desc: 'The government set up Maritime Trade Bureaus (Shibosi) in major ports to manage foreign trade and collect tariffs, highlighting its economic importance.',
        exchange_img_caption: 'A depiction of Song Dynasty maritime trade routes, showcasing its extensive overseas connections.',
        scholars_title: 'Scholars & Technology',
        scholars_intro: 'The Song was a peak period in Chinese scientific history, with the "Three Great Inventions" (printing, compass, gunpowder) being developed and widely applied. The erudition of the scholar class created a synergy between humanities and sciences.',
        scholar_1_name: 'Su Shi', scholar_1_desc: 'A Northern Song literary giant and artist, a rare polymath proficient in prose, poetry, calligraphy, and painting. His Ci poetry founded the "heroic" school.',
        scholar_2_name: 'Shen Kuo', scholar_2_desc: 'A Northern Song scientist whose "Dream Pool Essays" is a landmark in the history of Chinese science, covering astronomy, physics, geology, and medicine.',
        scholar_3_name: 'Bi Sheng', scholar_3_desc: 'The inventor of movable-type printing. His clay-based type was a revolution in printing, dramatically increasing efficiency and profoundly influencing world civilization.',
        scholar_4_name: 'Zhang Zeduan', scholar_4_desc: 'A renowned Northern Song painter. His masterpiece "Along the River During the Qingming Festival" is one of China\'s most famous paintings, detailing the life of the capital.',
        decline_title: 'Decline and Fall',
        decline_intro: 'The fall of the Song was a long, tragic process. The Northern Song fell to the emerging Jurchens (Jin), and the Southern Song was eventually worn down and conquered by the Mongols (Yuan) in a long war, ending with mass suicide at the Battle of Yamen.',
        decline_chart_caption: 'This chart illustrates the dynamic between Song national strength (green) and the threat from northern powers (gray). Despite its high civilization, the Song ultimately fell to relentless military pressure.',
        decline_box1_title: 'Jingkang Disgrace & Fall of N. Song', decline_box1_desc: 'Due to diplomatic and military failures, Jurchen armies sacked the capital and captured two emperors, leading to the dynasty\'s collapse.',
        decline_box2_title: 'Battle of Yamen & Fall of S. Song', decline_box2_desc: 'After decades of fierce resistance against the Mongols, the last Song forces were annihilated in a naval battle in 1279, marking the final end of the dynasty.',
        legacy_title: 'Historical Legacy',
        legacy_intro: 'Though it fell to foreign conquest, the Song\'s brilliant civilization profoundly influenced the Yuan, Ming, and Qing dynasties, and the entire East Asian sphere. Many of its cultural paradigms remain core parts of Chinese culture.',
        legacy_box1_title: 'Ideological & Institutional Legacy', legacy_box1_desc: 'The Neo-Confucianism developed in the Song became the state orthodoxy for centuries. Its model of a civilian-led, centralized bureaucracy was inherited and strengthened by the Ming and Qing.',
        legacy_box2_title: 'Cultural & Aesthetic Legacy', legacy_box2_desc: 'Song poetry, landscape painting, and ceramics became paragons of Chinese aesthetics. The rise of urban culture, tea culture, and other lifestyles continue to influence modern Chinese societies.',
        legacy_quote: '"The Song Dynasty was China\'s \'first modernization\'; its material, spiritual, and institutional civilizations all reached unprecedented heights."',
        legacy_quote_author: '— Naitō Konan, Japanese Historian',
        qingming_video_title: 'AI Simulated Video of Qingming Scroll',
        qingming_video_desc: "<strong>About 'Along the River During the Qingming Festival'</strong><br><br>'Along the River During the Qingming Festival' is a masterpiece by the Northern Song painter Zhang Zeduan and is one of the ten most famous classical Chinese paintings. This work, in the form of a long handscroll, utilizes a moving-focus perspective to vividly record the bustling prosperity and the lives of people from all social strata in the Northern Song capital, Bianjing (present-day Kaifeng, Henan), during the Qingming Festival.<br><br>The entire scroll can be divided into three sections: the first part depicts the rural landscape of the capital's suburbs; the middle part focuses on the busy transport on the Bian River and the lively scenes around the Rainbow Bridge; the final section showcases the bustling city streets with various shops and figures. The painting contains over 800 figures, more than 60 livestock animals, and over 20 boats. Its richness in detail and exquisite depiction make it a precious historical document for studying the urban life, economy, culture, and customs of the Song Dynasty.",
        chart_timeline_labels: ['Taizu', 'Zhenzong', 'Shenzong', 'Gaozong', 'Late Song'],
        chart_gov_title: 'Song Dynasty Bureaucracy Trend (Relative)',
        chart_gov_label_central: 'Civil Officials', chart_gov_label_provincial: 'Military Officials', chart_gov_yaxis: 'Relative Number Index',
        chart_rel_title: 'Song Maritime Trade Network',
        chart_rel_label: 'Trade Intensity', chart_rel_cats: ['Japan', 'Goryeo', 'SE Asia', 'Arabia', 'Persia', 'India'],
        chart_dec_title: 'Song Power vs. External Threats',
        chart_dec_label_central: 'Song Dynasty Power', chart_dec_label_regional: 'Northern Threat (Liao/Jin/Yuan)', chart_dec_yaxis: 'Relative Strength Index',
      }
    };

    // --- 核心腳本 ---
    document.addEventListener('DOMContentLoaded', function() {
        
        const AUTOPLAY_INTERVAL = 8000;

        let currentLang = 'zh-TW';
        let isAutoplaying = false;
        let autoplayTimeoutId;
        let currentSectionIndex = 0;
        let currentlySpeakingSection = null;
        let isManuallyStopped = false; 
        
        let activeLockSection = null;

        const sections = Array.from(document.querySelectorAll('main > section'));
        const langToggleBtn = document.getElementById('lang-toggle');
        const autoplayToggleBtn = document.getElementById('autoplay-toggle');
        const fullscreenToggleBtn = document.getElementById('fullscreen-toggle');
        const musicToggleBtn = document.getElementById('music-toggle');
        const toTopBtn = document.getElementById('to-top-btn');
        const bgMusic = document.getElementById('bg-music');
        const navbar = document.querySelector('.navbar');
        
        const wheelLockHandler = (event) => {
            if (!activeLockSection) return;
            const rect = activeLockSection.getBoundingClientRect();
            const isAtTop = rect.top >= 0;
            const isAtBottom = rect.bottom <= window.innerHeight;

            if (event.deltaY < 0 && isAtTop) { event.preventDefault(); }
            if (event.deltaY > 0 && isAtBottom) { event.preventDefault(); }
        };
        const touchLockHandler = (event) => {
             if (activeLockSection) { event.preventDefault(); }
        };
        function lockScreenToSection(section) {
            document.body.classList.add('tts-active');
            activeLockSection = section;
            window.addEventListener('wheel', wheelLockHandler, { passive: false });
            window.addEventListener('touchmove', touchLockHandler, { passive: false });
        }
        function unlockScreen() {
            document.body.classList.remove('tts-active');
            activeLockSection = null;
            window.removeEventListener('wheel', wheelLockHandler);
            window.removeEventListener('touchmove', touchLockHandler);
        }
        function setTtsButtonState(button, isPlaying) {
            const playKey = 'tts_play_btn';
            const stopKey = 'tts_stop_btn';
            if (isPlaying) {
                button.innerHTML = translations[currentLang][stopKey] || '⏹️ Stop Reading';
                button.classList.add('is-playing');
            } else {
                button.innerHTML = translations[currentLang][playKey] || '🔊 Read Aloud';
                button.classList.remove('is-playing');
            }
        }
        function resetAllTtsButtons() {
            document.querySelectorAll('.tts-btn').forEach(btn => {
                setTtsButtonState(btn, false);
            });
        }
        function updateLanguage() {
            document.documentElement.lang = currentLang;
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.dataset.langKey;
                if (translations[currentLang][key]) {
                    if (el.classList.contains('tts-btn') && el.classList.contains('is-playing')) {
                         el.innerHTML = translations[currentLang]['tts_stop_btn'];
                    } else {
                         el.innerHTML = translations[currentLang][key];
                    }
                }
            });
            initializeAllCharts(currentLang);
        }
        langToggleBtn.addEventListener('click', () => {
            currentLang = currentLang === 'zh-TW' ? 'en' : 'zh-TW';
            updateLanguage();
        });
        function getCleanTextForTTS(section) {
            const contentContainer = section.querySelector('.content-container');
            if (!contentContainer) return "";
            const clone = contentContainer.cloneNode(true);
            clone.querySelectorAll('.tts-btn, .section-title, .image-container-styled, canvas, .scholar-img, iframe').forEach(el => el.remove());
            const title = section.querySelector('.section-title')?.innerText || '';
            const body = clone.innerText.trim();
            return `${title}. ${body}`;
        }
        function stopAutoscroll() {
            isAutoplaying = false;
            document.body.classList.remove('autoplay-active'); 
            autoplayToggleBtn.innerHTML = '<i class="fas fa-play"></i>';
            clearTimeout(autoplayTimeoutId);
        }
        function stopSpeech() {
            if (!speechSynthesis.speaking) return;
            isManuallyStopped = true; 
            speechSynthesis.cancel(); 
        }
        function speakSection(section, onEndCallback) {
            const textToSpeak = getCleanTextForTTS(section);
            if (!textToSpeak) {
                if (onEndCallback) onEndCallback();
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = currentLang === 'en' ? 'en-US' : 'zh-TW';
            
            const ttsBtn = section.querySelector('.tts-btn');

            utterance.onstart = () => {
                currentlySpeakingSection = section;
                if (ttsBtn) setTtsButtonState(ttsBtn, true);
                lockScreenToSection(section);
            };
            
            utterance.onend = () => {
                const wasManuallyStopped = isManuallyStopped;
                if (currentlySpeakingSection === section) {
                    if (ttsBtn) setTtsButtonState(ttsBtn, false);
                    currentlySpeakingSection = null;
                }
                unlockScreen();
                if (onEndCallback && !wasManuallyStopped) {
                    onEndCallback();
                }
            };

            utterance.onerror = (e) => {
                console.error("Speech synthesis error:", e);
                if (currentlySpeakingSection === section) {
                    if (ttsBtn) setTtsButtonState(ttsBtn, false);
                    currentlySpeakingSection = null;
                }
                unlockScreen();
                if (onEndCallback) onEndCallback();
            };
            
            isManuallyStopped = false; 
            speechSynthesis.speak(utterance);
        }

        // *** MODIFIED FUNCTION ***
        function playAndAdvance() {
            if (!isAutoplaying) return;

            clearTimeout(autoplayTimeoutId);

            const section = sections[currentSectionIndex];
            if (!section) {
                stopAutoscroll();
                return;
            }

            section.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // ** NEW LOGIC **
            // If the current section is the video, stop the automatic advancement.
            // The user must click the play button again to restart from the beginning.
            if (section.id === 'qingming-video') {
                stopAutoscroll();
                return; // Stop the loop here
            }

            const advanceNext = () => {
                if (isAutoplaying) {
                    // Loop back to the start if it's the last section before the video
                    if (currentSectionIndex >= sections.length - 2) { // -2 because video is the last one
                        currentSectionIndex = 0;
                    } else {
                        currentSectionIndex++;
                    }
                    playAndAdvance();
                }
            };
            
            // Adjust the timeout logic to handle the loop correctly
            const isLastRegularSection = (currentSectionIndex === sections.length - 2);
            autoplayTimeoutId = setTimeout(() => {
                if (isAutoplaying) {
                    currentSectionIndex = isLastRegularSection ? 0 : currentSectionIndex + 1;
                    playAndAdvance();
                }
            }, AUTOPLAY_INTERVAL);
        }

        // *** MODIFIED FUNCTION ***
        function startAutoscroll() {
            if (isAutoplaying) return;
            
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }

            isAutoplaying = true;
            document.body.classList.add('autoplay-active'); 
            autoplayToggleBtn.innerHTML = '<i class="fas fa-pause"></i>';
            
            let mostVisibleSectionIndex = 0;
            let maxVisibility = 0;
            
            sections.forEach((section, index) => {
                const rect = section.getBoundingClientRect();
                const vh = window.innerHeight || document.documentElement.clientHeight;
                const visibleHeight = Math.max(0, Math.min(rect.bottom, vh) - Math.max(rect.top, 0));
                if (visibleHeight > maxVisibility) {
                    maxVisibility = visibleHeight;
                    mostVisibleSectionIndex = index;
                }
            });

            // ** NEW LOGIC **
            // If the user clicks play while viewing the video, restart from the home page.
            if (sections[mostVisibleSectionIndex] && sections[mostVisibleSectionIndex].id === 'qingming-video') {
                currentSectionIndex = 0;
            } else {
                currentSectionIndex = mostVisibleSectionIndex;
            }
            
            playAndAdvance();
        }

        autoplayToggleBtn.addEventListener('click', () => {
            if (isAutoplaying) {
                stopAutoscroll();
            } else {
                startAutoscroll();
            }
        });

        function updateFullscreenIcon() {
            if (!document.fullscreenElement) {
                fullscreenToggleBtn.innerHTML = '<i class="fas fa-expand"></i>';
            } else {
                fullscreenToggleBtn.innerHTML = '<i class="fas fa-compress"></i>';
            }
        }
        fullscreenToggleBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`無法進入全螢幕模式: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        });
        document.addEventListener('fullscreenchange', updateFullscreenIcon);
        musicToggleBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("音樂自動播放被瀏覽器阻止。"));
                musicToggleBtn.innerHTML = '<i class="fas fa-music"></i>';
            } else {
                bgMusic.pause();
                musicToggleBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            }
        });
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('visible');
          });
        }, { threshold: 0.15 });
        document.querySelectorAll('.scroll-reveal').forEach(el => observer.observe(el));
        function getCurrentSectionId() {
            let current = '';
            for (const section of sections) {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= sectionTop - 200) current = section.getAttribute('id');
            }
            return current;
        }
        window.addEventListener('scroll', () => {
            if(document.body.classList.contains('tts-active')) return;

            if (window.pageYOffset > 300) { toTopBtn.style.display = 'flex'; } 
            else { toTopBtn.style.display = 'none'; }
            if (window.scrollY > 50) { navbar.classList.add('scrolled'); } 
            else { navbar.classList.remove('scrolled'); }
            
            const current = getCurrentSectionId();
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').includes(current)) link.classList.add('active');
            });
        });
        toTopBtn.addEventListener('click', () => {
            stopAutoscroll();
            stopSpeech();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                stopAutoscroll();
                stopSpeech();
            });
        });
        document.querySelectorAll('.hotspot').forEach(hotspot => {
          hotspot.addEventListener('click', (e) => {
            e.stopPropagation();
            const targetId = hotspot.dataset.target;
            const infoBox = document.getElementById(targetId);
            const isVisible = infoBox.style.display === 'block';
            document.querySelectorAll('.info-box').forEach(box => box.style.display = 'none');
            if (infoBox && !isVisible) infoBox.style.display = 'block';
          });
        });
        document.addEventListener('click', () => {
             document.querySelectorAll('.info-box').forEach(box => box.style.display = 'none');
        });
        document.querySelectorAll('.tts-btn').forEach(button => {
            button.addEventListener('click', () => {
                if (isAutoplaying) return;
                const section = button.closest('.slide-section');
                if (!section) return;
                const wasSpeakingThisSection = (currentlySpeakingSection === section && speechSynthesis.speaking);
                stopSpeech();
                if (!wasSpeakingThisSection) {
                    speakSection(section, null); 
                }
            });
        });

        let charts = {};
        function initializeAllCharts(lang) {
            const langData = translations[lang];
            const titleFont = { family: "'Noto Serif TC', serif", size: 20, weight: 'bold' };
            const bodyFont = { family: "'Noto Serif TC', serif", size: 16 };
            const primaryColor = '#4A6C5B';
            const accentColor = '#A99A86';
            const darkText = '#3D3D3D';

            Object.keys(charts).forEach(id => {
                if(charts[id]) charts[id].destroy();
            });

            Chart.defaults.color = darkText; 
            Chart.defaults.font.family = "'Noto Serif TC', serif";

            if (document.getElementById('timelineChart')) {
              const ctx = document.getElementById('timelineChart').getContext('2d');
              charts.timeline = new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: langData.chart_timeline_labels,
                  datasets: [{
                    data: [16, 25, 18, 35, 117], 
                    backgroundColor: ['#4A6C5B', '#638575', '#7D9F90', '#638575', '#3A5647'],
                    borderColor: accentColor, borderWidth: 1,
                    barPercentage: 1, categoryPercentage: 1
                  }]
                },
                options: { 
                  indexAxis: 'y', responsive: true, maintainAspectRatio: false, 
                  plugins: { legend: { display: false } }, 
                  scales: { x: { ticks: { display: false }, grid: { display: false } }, y: { ticks: { font: bodyFont, color: darkText }, grid: { display: false } } } 
                }
              });
            }

            if (document.getElementById('governmentChart')) {
              const ctx = document.getElementById('governmentChart').getContext('2d');
              charts.government = new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: lang === 'zh-TW' ? ['北宋', '南宋'] : ['N. Song', 'S. Song'],
                  datasets: [
                    { label: langData.chart_gov_label_central, data: [70, 80], backgroundColor: 'rgba(74, 108, 91, 0.7)', borderColor: primaryColor, borderWidth: 2 }, 
                    { label: langData.chart_gov_label_provincial, data: [30, 20], backgroundColor: 'rgba(169, 154, 134, 0.7)', borderColor: accentColor, borderWidth: 2 }
                  ]
                },
                options: { 
                  responsive: true, maintainAspectRatio: false, 
                  plugins: { title: { display: true, text: langData.chart_gov_title, font: titleFont, color: primaryColor }, legend: { position: 'bottom', labels: { font: bodyFont } } }, 
                  scales: { y: { beginAtZero: true, title: { display: true, text: langData.chart_gov_yaxis, font: bodyFont } } } 
                }
              });
            }
            
            if (document.getElementById('relationChart')) {
              const ctx = document.getElementById('relationChart').getContext('2d');
              charts.relation = new Chart(ctx, {
                type: 'radar',
                data: {
                  labels: langData.chart_rel_cats,
                  datasets: [{
                    label: langData.chart_rel_label, data: [75, 70, 95, 85, 80, 65],
                    backgroundColor: 'rgba(74, 108, 91, 0.3)', borderColor: primaryColor, borderWidth: 2, 
                    pointBackgroundColor: accentColor, pointBorderColor: '#fff', 
                    pointHoverBackgroundColor: '#fff', pointHoverBorderColor: primaryColor
                  }]
                },
                options: { 
                  responsive: true, maintainAspectRatio: false, 
                  plugins: { title: { display: true, text: langData.chart_rel_title, font: titleFont, color: primaryColor }, legend: { display: false } }, 
                  scales: { r: { pointLabels: { font: { ...bodyFont, weight: 'bold' }, color: darkText }, grid: { color: 'rgba(0,0,0,0.1)' }, angleLines: { color: 'rgba(0,0,0,0.1)' } } } 
                }
              });
            }

            if (document.getElementById('declineChart')) {
              const ctx = document.getElementById('declineChart').getContext('2d');
              charts.decline = new Chart(ctx, {
                type: 'line',
                data: {
                  labels: lang === 'zh-TW' ? ['1000年', '1127年', '1200年', '1279年'] : ['1000', '1127', '1200', '1279'],
                  datasets: [
                    { label: langData.chart_dec_label_central, data: [80, 40, 35, 0], borderColor: primaryColor, backgroundColor: 'rgba(74, 108, 91, 0.2)', tension: 0.1, fill: true },
                    { label: langData.chart_dec_label_regional, data: [60, 90, 85, 100], borderColor: accentColor, backgroundColor: 'rgba(169, 154, 134, 0.2)', tension: 0.1, fill: true }
                  ]
                },
                options: { 
                  responsive: true, maintainAspectRatio: false, 
                  plugins: { title: { display: true, text: langData.chart_dec_title, font: titleFont, color: primaryColor }, legend: { position: 'bottom', labels: { font: bodyFont } } }, 
                  scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: langData.chart_dec_yaxis, font: bodyFont } } } 
                }
              });
            }
        }

        updateLanguage();
        
        document.addEventListener('click', function initMusic() {
          if(bgMusic.paused){
            bgMusic.play().catch(e => console.log("音樂自動播放被瀏覽器阻止。"));
            musicToggleBtn.innerHTML = '<i class="fas fa-music"></i>';
          }
          document.removeEventListener('click', initMusic);
        });
    });
    </script>
</body>
</html>